import{r as _r,a as Jt,g as vr,c as Pe}from"./vendor-react-C6Ba5J37.js";import{r as S,R as de,c as yr}from"./vendor-zustand-CyDtV0kx.js";import{L as gr,X as Qt,C as Vt,S as Xt,a as Ye,A as mr,P as br,T as xr,b as Yt,E as Zt,F as wr,H as jr,M as kr,c as Oe,U as Sr,d as Cr,G as Nr,e as Er,R as Ze,f as Or,g as Pr,W as Ir}from"./vendor-ui-HwjcNjrH.js";import{S as Rr,g as ke,f as Se,n as Mr}from"./vendor-nostr-CMmJ9SWd.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const e of o.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&s(e)}).observe(document,{childList:!0,subtree:!0});function h(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=h(r);fetch(r.href,o)}})();var Fe={exports:{}},pe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var et;function Lr(){if(et)return pe;et=1;var u=_r(),i=Symbol.for("react.element"),h=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function e(n,t,a){var f,c={},l=null,d=null;a!==void 0&&(l=""+a),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(d=t.ref);for(f in t)s.call(t,f)&&!o.hasOwnProperty(f)&&(c[f]=t[f]);if(n&&n.defaultProps)for(f in t=n.defaultProps,t)c[f]===void 0&&(c[f]=t[f]);return{$$typeof:i,type:n,key:l,ref:d,props:c,_owner:r.current}}return pe.Fragment=h,pe.jsx=e,pe.jsxs=e,pe}var tt;function zr(){return tt||(tt=1,Fe.exports=Lr()),Fe.exports}var p=zr(),Ce={},rt;function qr(){if(rt)return Ce;rt=1;var u=Jt();return Ce.createRoot=u.createRoot,Ce.hydrateRoot=u.hydrateRoot,Ce}var Fr=qr();const Ar=vr(Fr);class Tr extends S.Component{state={hasError:!1,error:null,errorInfo:null};static getDerivedStateFromError(i){return{hasError:!0,error:i,errorInfo:null}}componentDidCatch(i,h){console.error("ðŸš¨ ErrorBoundary caught an error:",i,h),this.setState({error:i,errorInfo:h})}handleReload=()=>{window.location.reload()};handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:p.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-6",children:p.jsxs("div",{className:"max-w-md w-full text-center space-y-6",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº"}),p.jsx("p",{className:"text-gray-600",children:"ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð½ÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°. ÐœÑ‹ ÑƒÐ¶Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ð½Ð°Ð´ ÐµÑ‘ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼."})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("button",{onClick:this.handleRetry,className:"w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ½Ð¾Ð²Ð°"}),p.jsx("button",{onClick:this.handleReload,className:"w-full px-4 py-2 bg-gray-200 text-gray-900 rounded hover:bg-gray-300",children:"ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"})]}),!1]})}):this.props.children}}var $r=Jt();const Ie=({children:u,id:i="portal-root"})=>{const[h,s]=de.useState(null);return de.useEffect(()=>{let r=document.getElementById(i);return r||(r=document.createElement("div"),r.id=i,r.className="fixed inset-0 z-portal",document.body.appendChild(r)),s(r),()=>{r&&r.children.length===0&&document.body.removeChild(r)}},[i]),h?$r.createPortal(u,h):null},O=S.forwardRef(({variant:u="primary",size:i="md",loading:h=!1,disabled:s,children:r,className:o="",...e},n)=>{const t="btn-zen",a={primary:"btn-primary",secondary:"btn-secondary",ghost:"btn-ghost",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"},f={sm:"px-3 py-1.5 text-tetra-sm",md:"px-4 py-2 text-tetra-base",lg:"px-6 py-3 text-tetra-lg"};return p.jsxs("button",{ref:n,className:`${t} ${a[u]} ${f[i]} ${o}`,disabled:s||h,...e,children:[h&&p.jsx(gr,{className:"w-4 h-4 mr-2 animate-spin-elegant"}),r]})});O.displayName="Button";const Re=S.forwardRef(({label:u,error:i,icon:h,className:s="",...r},o)=>p.jsxs("div",{className:"space-y-1",children:[u&&p.jsx("label",{className:"block text-tetra-sm font-medium text-zen-700",children:u}),p.jsxs("div",{className:"relative",children:[h&&p.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none z-10",children:p.jsx("div",{className:"text-zen-700 opacity-80",children:h})}),p.jsx("input",{ref:o,className:`input-zen ${h?"pl-10":""} ${i?"border-red-500 focus:border-red-500 focus:ring-red-500":""} ${s}`,...r})]}),i&&p.jsx("p",{className:"text-tetra-sm text-red-600",children:i})]}));Re.displayName="Input";const Hr=({label:u,error:i,className:h="",...s})=>p.jsxs("div",{className:"space-y-1",children:[u&&p.jsx("label",{className:"block text-tetra-sm font-medium text-zen-700",children:u}),p.jsx("textarea",{className:`input-zen resize-none ${i?"border-red-500 focus:border-red-500 focus:ring-red-500":""} ${h}`,...s}),i&&p.jsx("p",{className:"text-tetra-sm text-red-600",children:i})]}),Ae=({options:u,value:i,onChange:h,label:s,placeholder:r,error:o,className:e="",disabled:n=!1})=>p.jsxs("div",{className:"space-y-1",children:[s&&p.jsx("label",{className:"block text-tetra-sm font-medium text-zen-700",children:s}),p.jsxs("select",{value:i,onChange:t=>h(t.target.value),disabled:n,className:`input-zen ${o?"border-red-500 focus:border-red-500 focus:ring-red-500":""} ${e}`,children:[r&&p.jsx("option",{value:"",disabled:!0,children:r}),u.map(t=>p.jsxs("option",{value:t.value,children:[t.icon&&`${t.icon} `,t.label]},t.value))]}),o&&p.jsx("p",{className:"text-tetra-sm text-red-600",children:o})]}),Me=({isOpen:u,onClose:i,title:h,children:s,size:r="md"})=>{if(de.useEffect(()=>(u?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[u]),!u)return null;const o={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return p.jsx(Ie,{children:p.jsx("div",{className:"modal-backdrop",onClick:i,children:p.jsxs("div",{className:`modal-content ${o[r]}`,onClick:e=>e.stopPropagation(),children:[h&&p.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-zen-200",children:[p.jsx("h3",{className:"text-tetra-xl font-semibold text-zen-900",children:h}),p.jsx(O,{variant:"ghost",size:"sm",onClick:i,children:p.jsx(Qt,{className:"w-5 h-5"})})]}),p.jsx("div",{className:"p-6",children:s})]})})})},er=({children:u,hover:i=!1,className:h="",onClick:s})=>{const r=i?"card-zen-hover":"card-zen";return p.jsx("div",{className:`${r} ${s?"cursor-pointer":""} ${h}`,onClick:s,children:u})},je=({size:u="md",variant:i="default",className:h=""})=>{const s={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},r={default:"spinner-zen",primary:"spinner-primary"};return p.jsx("div",{className:`${r[i]} ${s[u]} ${h}`})},tr=({src:u,alt:i,name:h,size:s="md",className:r="",onClick:o})=>{const e={sm:"w-8 h-8 text-tetra-sm",md:"w-10 h-10 text-tetra-base",lg:"w-12 h-12 text-tetra-lg"},n=h?.split(" ").map(t=>t[0]).join("").toUpperCase()||"?";return p.jsx("div",{className:`${e[s]} rounded-full bg-zen-100 border border-zen-200 
                  flex items-center justify-center overflow-hidden
                  ${o?"cursor-pointer interactive":""} ${r}`,onClick:o,children:u?p.jsx("img",{src:u,alt:i||h||"Avatar",className:"w-full h-full object-cover"}):p.jsx("span",{className:"font-medium text-zen-600",children:n})})},Dr={ui:{search:"ÐŸÐ¾Ð¸ÑÐº...",menu:"ÐœÐµÐ½ÑŽ",createPost:"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚",title:"Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº",description:"ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ",save:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",cancel:"ÐžÑ‚Ð¼ÐµÐ½Ð°",delete:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",edit:"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",like:"ÐÑ€Ð°Ð²Ð¸Ñ‚ÑÑ",report:"ÐŸÐ¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒÑÑ",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ",favorite:"Ð’ Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ",draft:"Ñ‡ÐµÑ€Ð½Ð¾Ð²Ð¸Ðº",connecting:"ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Nostr...",connected:"ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ Ðº Nostr",disconnected:"ÐÐµÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ",noPosts:"Ð—Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚",languageSelection:"Ð’Ñ‹Ð±Ð¾Ñ€ ÑÐ·Ñ‹ÐºÐ°",selectLanguage:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°",changeLanguage:"Ð¡Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÐ·Ñ‹Ðº",loading:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...",loadMore:"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÐµÑ‰Ñ‘",showMore:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ",removeFromFavorites:"Ð£Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾"},filters:{resetAll:"Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹",selected:"Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð¾",city:{label:"Ð“Ð¾Ñ€Ð¾Ð´",placeholder:"ÐŸÐ¾Ð¸ÑÐº Ð³Ð¾Ñ€Ð¾Ð´Ð°...",options:{all:"Ð’ÑÐµ Ð³Ð¾Ñ€Ð¾Ð´Ð°",moscow:"ÐœÐ¾ÑÐºÐ²Ð°",petersburg:"Ð¡Ð°Ð½ÐºÑ‚-ÐŸÐµÑ‚ÐµÑ€Ð±ÑƒÑ€Ð³",novosibirsk:"ÐÐ¾Ð²Ð¾ÑÐ¸Ð±Ð¸Ñ€ÑÐº",ekaterinburg:"Ð•ÐºÐ°Ñ‚ÐµÑ€Ð¸Ð½Ð±ÑƒÑ€Ð³",kazan:"ÐšÐ°Ð·Ð°Ð½ÑŒ",nizhny:"ÐÐ¸Ð¶Ð½Ð¸Ð¹ ÐÐ¾Ð²Ð³Ð¾Ñ€Ð¾Ð´",chelyabinsk:"Ð§ÐµÐ»ÑÐ±Ð¸Ð½ÑÐº",samara:"Ð¡Ð°Ð¼Ð°Ñ€Ð°",omsk:"ÐžÐ¼ÑÐº",rostov:"Ð Ð¾ÑÑ‚Ð¾Ð²-Ð½Ð°-Ð”Ð¾Ð½Ñƒ",ufa:"Ð£Ñ„Ð°",krasnoyarsk:"ÐšÑ€Ð°ÑÐ½Ð¾ÑÑ€ÑÐº",voronezh:"Ð’Ð¾Ñ€Ð¾Ð½ÐµÐ¶",perm:"ÐŸÐµÑ€Ð¼ÑŒ",volgograd:"Ð’Ð¾Ð»Ð³Ð¾Ð³Ñ€Ð°Ð´"}},tag:{label:"ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ",options:{all:"Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸",general:"ÐžÐ±Ñ‰ÐµÐµ",sport:"Ð¡Ð¿Ð¾Ñ€Ñ‚",work:"Ð Ð°Ð±Ð¾Ñ‚Ð°",tech:"Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸",art:"Ð˜ÑÐºÑƒÑÑÑ‚Ð²Ð¾",music:"ÐœÑƒÐ·Ñ‹ÐºÐ°",food:"Ð•Ð´Ð°",travel:"ÐŸÑƒÑ‚ÐµÑˆÐµÑÑ‚Ð²Ð¸Ñ",health:"Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ",education:"ÐžÐ±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ",finance:"Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹",gaming:"Ð˜Ð³Ñ€Ñ‹"}},gender:{label:"ÐŸÐ¾Ð»",options:{all:"Ð’ÑÐµ",male:"ÐœÑƒÐ¶ÑÐºÐ¾Ð¹",female:"Ð–ÐµÐ½ÑÐºÐ¸Ð¹"}},sort:{label:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°",options:{my:"ÐœÐ¾Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ¸",favorites:"Ð˜Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ",hidden:"Ð¡ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ",popular:"ÐŸÐ¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ",new:"ÐÐ¾Ð²Ñ‹Ðµ",old:"Ð¡Ñ‚Ð°Ñ€Ñ‹Ðµ"}}},reports:{title:"ÐŸÐ¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ð¾ÑÑ‚",subtitle:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñƒ Ð¶Ð°Ð»Ð¾Ð±Ñ‹:",submit:"ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ",cancel:"ÐžÑ‚Ð¼ÐµÐ½Ð°",reasons:{illegal:{name:"ÐÐµÐ·Ð°ÐºÐ¾Ð½Ð½Ñ‹Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹",icon:"ðŸš«"},fraud:{name:"ÐœÐ¾ÑˆÐµÐ½Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¸Ð»Ð¸ ÑÐ¿Ð°Ð¼",icon:"âš ï¸"},provocation:{name:"ÐŸÑ€Ð¾Ð²Ð¾ÐºÐ°Ñ†Ð¸Ñ",icon:"ðŸ”¥"},advertising:{name:"ÐÐ°Ð²ÑÐ·Ñ‡Ð¸Ð²Ð°Ñ Ñ€ÐµÐºÐ»Ð°Ð¼Ð°",icon:"ðŸ“¢"},inappropriate:{name:"ÐÐµÐ°Ð´ÐµÐºÐ²Ð°Ñ‚Ð½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚",icon:"âŒ"}}},posts:{form:{titlePlaceholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº...",contentPlaceholder:"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ...",publishing:"ÐŸÑƒÐ±Ð»Ð¸ÐºÑƒÐµÐ¼ Ð¿Ð¾ÑÑ‚...",published:"ÐŸÐ¾ÑÑ‚ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½!",error:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð¿Ð¾ÑÑ‚Ð°"},cities:{moscow:"ðŸ™ï¸ ÐœÐ¾ÑÐºÐ²Ð°",petersburg:"ðŸ›ï¸ Ð¡Ð°Ð½ÐºÑ‚-ÐŸÐµÑ‚ÐµÑ€Ð±ÑƒÑ€Ð³",novosibirsk:"ðŸŒ† ÐÐ¾Ð²Ð¾ÑÐ¸Ð±Ð¸Ñ€ÑÐº",ekaterinburg:"ðŸ—ï¸ Ð•ÐºÐ°Ñ‚ÐµÑ€Ð¸Ð½Ð±ÑƒÑ€Ð³",kazan:"ðŸ•Œ ÐšÐ°Ð·Ð°Ð½ÑŒ",nizhny:"ðŸŒ‰ ÐÐ¸Ð¶Ð½Ð¸Ð¹ ÐÐ¾Ð²Ð³Ð¾Ñ€Ð¾Ð´"},genders:{male:"ðŸ‘¨ ÐœÑƒÐ¶ÑÐºÐ¾Ð¹",female:"ðŸ‘© Ð–ÐµÐ½ÑÐºÐ¸Ð¹"},actions:{edit:"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",delete:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",confirmDelete:"Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ Ð¿Ð¾ÑÑ‚?"}},status:{connecting:"ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÑÐµÑ‚Ð¸...",disconnected:"ÐÐµÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº ÑÐµÑ‚Ð¸",noPostsFound:"ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",changeFilters:"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹",likeError:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð»Ð°Ð¹Ðº"}},Kr={ui:{search:"Search...",menu:"Menu",createPost:"Create Post",title:"Title",description:"Description",save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",like:"Like",report:"Report",hide:"Hide",favorite:"Add to Favorites",draft:"draft",connecting:"Connecting to Nostr...",connected:"Connected to Nostr",disconnected:"No Connection",noPosts:"No posts yet",languageSelection:"Language Selection",selectLanguage:"Select interface language",changeLanguage:"Change Language",loading:"Loading...",loadMore:"Load More",showMore:"Show More",removeFromFavorites:"Remove from Favorites"},filters:{resetAll:"Reset Filters",selected:"selected",city:{label:"City",placeholder:"Search city...",options:{all:"All Cities",moscow:"Moscow",petersburg:"Saint Petersburg",novosibirsk:"Novosibirsk",ekaterinburg:"Ekaterinburg",kazan:"Kazan",nizhny:"Nizhny Novgorod",chelyabinsk:"Chelyabinsk",samara:"Samara",omsk:"Omsk",rostov:"Rostov-on-Don",ufa:"Ufa",krasnoyarsk:"Krasnoyarsk",voronezh:"Voronezh",perm:"Perm",volgograd:"Volgograd"}},tag:{label:"Category",options:{all:"All Categories",general:"General",sport:"Sport",work:"Work",tech:"Technology",art:"Art",music:"Music",food:"Food",travel:"Travel",health:"Health",education:"Education",finance:"Finance",gaming:"Gaming"}},gender:{label:"Gender",options:{all:"All",male:"Male",female:"Female"}},sort:{label:"Sort",options:{my:"My Posts",favorites:"Favorites",hidden:"Hidden",popular:"Popular",new:"New",old:"Old"}}},reports:{title:"Report Post",subtitle:"Select report reason:",submit:"Submit",cancel:"Cancel",reasons:{illegal:{name:"Illegal goods",icon:"ðŸš«"},fraud:{name:"Fraud or spam",icon:"âš ï¸"},provocation:{name:"Provocation",icon:"ðŸ”¥"},advertising:{name:"Intrusive advertising",icon:"ðŸ“¢"},inappropriate:{name:"Inappropriate content",icon:"âŒ"}}},posts:{form:{titlePlaceholder:"Enter title...",contentPlaceholder:"Tell us more...",publishing:"Publishing post...",published:"Post published!",error:"Failed to publish post"},cities:{moscow:"ðŸ™ï¸ Moscow",petersburg:"ðŸ›ï¸ Saint Petersburg",novosibirsk:"ðŸŒ† Novosibirsk",ekaterinburg:"ðŸ—ï¸ Ekaterinburg",kazan:"ðŸ•Œ Kazan",nizhny:"ðŸŒ‰ Nizhny Novgorod"},genders:{male:"ðŸ‘¨ Male",female:"ðŸ‘© Female"},actions:{edit:"Edit",delete:"Delete",confirmDelete:"Are you sure you want to delete this post?"}},status:{connecting:"Connecting to network...",disconnected:"No network connection",noPostsFound:"No posts found",changeFilters:"Try changing the filters",likeError:"Failed to update like"}},Ue={ru:Dr,en:Kr},rr=[{code:"ru",name:"Russian",nativeName:"Ð ÑƒÑÑÐºÐ¸Ð¹"},{code:"en",name:"English",nativeName:"English"}],Be=u=>Ue[u]||Ue.ru,nt=(u,i,h)=>{const s=Be(u),r=i.split(".");let o=s;for(const e of r)if(o=o?.[e],o===void 0)break;return o||h||`Missing: ${i}`},Ur=(u,i)=>{const s=Be(u).filters[i].options;return Object.entries(s).map(([r,o])=>({id:r,name:o,icon:Br(i,r)}))},Br=(u,i)=>({tag:{general:"ðŸ’¬",sport:"âš½",work:"ðŸ’¼",tech:"ðŸ’»",art:"ðŸŽ¨",music:"ðŸŽµ",food:"ðŸ•",travel:"âœˆï¸",health:"ðŸ¥",education:"ðŸ“š",finance:"ðŸ’°",gaming:"ðŸŽ®"}})[u]?.[i],Gr=u=>{const i=Be(u);return Object.entries(i.reports.reasons).map(([h,s])=>({id:h,name:s.name,icon:s.icon}))},Wr=u=>Object.keys(Ue).includes(u),Jr=()=>{const u=window.Telegram?.WebApp?.initDataUnsafe?.user?.language_code;if(u?.startsWith("ru"))return"ru";if(u?.startsWith("en"))return"en";const i=navigator.language.split("-")[0];return Wr(i)?i:"ru"};class g{static debug(i,...h){}static info(i,...h){console.log(`â„¹ï¸ ${i}`,...h)}static warn(i,...h){console.warn(`âš ï¸ ${i}`,...h)}static error(i,...h){console.error(`âŒ ${i}`,...h)}}function Qr(u,i){let h;return(...s)=>{clearTimeout(h),h=setTimeout(()=>u(...s),i)}}function Vr(u){const i=new Map;return(...h)=>{const s=JSON.stringify(h);if(i.has(s))return i.get(s);const r=u(...h);return i.set(s,r),r}}class Xr{pool;privateKey=new Uint8Array(32);publicKey="";relays=["wss://sub-muey.onrender.com"];connectedRelays=new Set;subscriptions=new Map;isReconnecting=!1;reconnectTimeouts=new Map;lastEventTimestamp=0;connectionMonitorInterval;onConnectionChange;networkListeners;constructor(){this.pool=new Rr,this.initializeKeys()}setConnectionCallback(i){this.onConnectionChange=i}async initializeKeys(){if(g.info("Initializing Nostr keys"),!window.Telegram?.WebApp?.CloudStorage){g.warn("Telegram Cloud Storage not available, using fallback"),this.initializeKeysLegacy();return}try{const i=await this.getKeyFromCloud();i?(this.privateKey=Uint8Array.from(JSON.parse(i)),this.publicKey=ke(this.privateKey),g.debug("Loaded existing key from cloud")):(this.privateKey=this.generateNewKey(),this.publicKey=ke(this.privateKey),await this.saveKeyToCloud(JSON.stringify(Array.from(this.privateKey))),g.debug("Generated new key and saved to cloud"))}catch(i){g.error("Cloud storage failed, using fallback:",i),this.initializeKeysLegacy()}}getKeyFromCloud(){return new Promise(i=>{if(!window.Telegram?.WebApp?.CloudStorage){i(null);return}window.Telegram.WebApp.CloudStorage.getItem("nostr_private_key",(h,s)=>{h?(g.warn("Error reading from cloud storage:",h),i(null)):i(s)})})}saveKeyToCloud(i){return new Promise(h=>{if(!window.Telegram?.WebApp?.CloudStorage){h(!1);return}window.Telegram.WebApp.CloudStorage.setItem("nostr_private_key",i,(s,r)=>{s?(g.warn("Error saving to cloud storage:",s),h(!1)):(g.debug("Private key saved to cloud storage"),h(r))})})}generateNewKey(){const i=new Uint8Array(32);return crypto.getRandomValues(i),i}initializeKeysLegacy(){const i=this.getUserId(),h=localStorage.getItem("nostr_privateKey"),s=localStorage.getItem("nostr_userId");if(h&&s===i)try{this.privateKey=Uint8Array.from(JSON.parse(h)),this.publicKey=ke(this.privateKey),g.debug("Using saved legacy key");return}catch(r){g.warn("Error loading legacy key:",r)}this.privateKey=this.generateNewKey(),this.publicKey=ke(this.privateKey),localStorage.setItem("nostr_privateKey",JSON.stringify(Array.from(this.privateKey))),localStorage.setItem("nostr_userId",i),g.debug("Generated new legacy key")}getUserId(){const i=window.Telegram?.WebApp?.initDataUnsafe?.user;if(i?.id)return`tg_${i.id}`;const h=window.gapi?.auth2?.getAuthInstance()?.currentUser?.get();return h?.getId()?`google_${h.getId()}`:`demo_${Date.now()}`}async connect(){await this.initializeKeys(),g.info("Connecting to Nostr relays"),this.startConnectionMonitor(),this.setupNetworkListeners();const i=this.relays.slice(0,Math.ceil(this.relays.length*.618)),h=this.relays.slice(i.length);this.onConnectionChange?.("connecting"),this.waitForInitialConnection();const s=i.map(async r=>{try{const o=await this.pool.ensureRelay(r);return this.connectedRelays.add(r),g.debug("Connected to primary relay:",r),o}catch(o){return g.warn("Failed to connect to primary relay:",r,o),this.scheduleReconnect(r,3e3),null}});await Promise.allSettled(s),setTimeout(async()=>{const r=h.map(async o=>{try{const e=await this.pool.ensureRelay(o);return this.connectedRelays.add(o),g.debug("Connected to secondary relay:",o),e}catch(e){return g.warn("Failed to connect to secondary relay:",o,e),this.scheduleReconnect(o,5e3),null}});await Promise.allSettled(r),g.info(`Total connected relays: ${this.connectedRelays.size}/${this.relays.length}`),this.connectedRelays.size>0?this.onConnectionChange?.("connected"):this.onConnectionChange?.("disconnected")},618)}async publishPost(i,h,s,r){const o=this.getUserInfo(),e={kind:1,created_at:Math.floor(Date.now()/1e3),tags:[["t",s],["title",i],["city",r.city||""],["gender",r.gender||""],["app","nostr-social-feed"],["lang",r.language||"ru"],["author_name",o?.name||""],["author_photo",o?.photo_url||""],["author_type",o?.type||"demo"],["author_username",o?.username||""],["author_email",o?.email||""],["profile_link",o?.profile_link||""]],content:`${i}

${h}`},n=Se(e,this.privateKey);g.debug("Publishing post to Nostr");const t=Array.from(this.connectedRelays).map(async c=>{try{return await this.pool.publish([c],n),g.debug("Posted to relay:",c),{success:!0,relay:c}}catch(l){return g.warn("Failed to publish to relay:",c,l),{success:!1,relay:c,error:l}}}),f=(await Promise.allSettled(t)).filter(c=>c.status==="fulfilled"&&c.value.success).length;if(g.info(`Publication results: ${f}/${this.connectedRelays.size} relays succeeded`),f===0)throw new Error(`Failed to publish to any relay (tried ${this.connectedRelays.size} relays)`);return n.id}async publishLike(i,h,s=!1){const r={kind:7,created_at:Math.floor(Date.now()/1e3),tags:[["e",i],["p",h],["k","1"]],content:s?"":"â¤ï¸"};s&&r.tags.push(["action","unlike"]);const o=Se(r,this.privateKey),n=Array.from(this.connectedRelays).slice(0,3).map(async t=>{try{await this.pool.publish([t],o)}catch(a){g.warn(`Failed to publish ${s?"unlike":"like"} to relay:`,t,a)}});await Promise.allSettled(n)}subscribeToFeed(i,h,s={}){const r=`feed_${Date.now()}`,o=this.pool.subscribeMany(Array.from(this.connectedRelays),[{kinds:[1,5],"#app":["nostr-social-feed"],limit:1e5,since:Math.floor(Date.now()/1e3)-30*24*60*60,...s}],{onevent:e=>{this.lastEventTimestamp=e.created_at,e.kind===5&&h?h(e):e.kind===1&&i(e)},oneose:()=>{g.debug("Feed subscription established:",r)}});return this.subscriptions.set(r,o),r}subscribeToLikes(i){const h=`likes_${Date.now()}`,s=this.pool.subscribeMany(Array.from(this.connectedRelays),[{kinds:[7],limit:500,since:Math.floor(Date.now()/1e3)-30*24*60*60}],{onevent:r=>{r.tags.find(e=>e[0]==="action")?.[1]==="unlike"||r.content,i(r)}});return this.subscriptions.set(h,s),h}getPublicKey(){return this.publicKey}getNpub(){return Mr.npubEncode(this.publicKey)}getTelegramUser(){return window.Telegram?.WebApp?.initDataUnsafe?.user||null}getUserInfo(){const i=window.Telegram?.WebApp?.initDataUnsafe?.user;if(i)return{type:"telegram",id:i.id,name:`${i.first_name} ${i.last_name||""}`.trim(),username:i.username,photo_url:i.photo_url,profile_link:i.username?`https://t.me/${i.username}`:`tg://user?id=${i.id}`};const h=window.gapi?.auth2?.getAuthInstance()?.currentUser?.get();if(h?.getId()){const s=h.getBasicProfile();return{type:"google",id:h.getId(),name:s.getName(),email:s.getEmail(),photo_url:s.getImageUrl(),profile_link:`mailto:${s.getEmail()}`}}return null}getUserProfileLink(){return this.getUserInfo()?.profile_link||null}isMyPost(i){return i===this.publicKey}getConnectedRelays(){return Array.from(this.connectedRelays)}async publishReport(i,h){const s={kind:1984,created_at:Math.floor(Date.now()/1e3),tags:[["e",i],["p",""],["report",h]],content:`Report: ${h}`},r=Se(s,this.privateKey),o=Array.from(this.connectedRelays).map(async e=>{try{await this.pool.publish([e],r)}catch(n){g.warn("Failed to publish report to",e,n)}});await Promise.allSettled(o)}async deletePost(i){const h={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",i],["app","nostr-social-feed"]],content:"Deleted by author"},s=Se(h,this.privateKey),r=Array.from(this.connectedRelays).map(async o=>{try{await this.pool.publish([o],s)}catch(e){g.warn("Failed to publish delete to",o,e)}});await Promise.allSettled(r)}cleanup(){this.connectionMonitorInterval&&clearInterval(this.connectionMonitorInterval),this.reconnectTimeouts.forEach(i=>clearTimeout(i)),this.reconnectTimeouts.clear(),this.networkListeners&&(window.removeEventListener("online",this.networkListeners.handleOnline),window.removeEventListener("offline",this.networkListeners.handleOffline)),this.subscriptions.forEach(i=>{try{i.close()}catch(h){g.warn("Failed to unsubscribe:",h)}}),this.subscriptions.clear(),this.pool.close(Array.from(this.connectedRelays)),g.info("Nostr client cleaned up")}setupNetworkListeners(){const i=()=>{g.info("Network back online, attempting reconnect"),this.handleNetworkReconnect().catch(s=>{g.error("Network reconnect failed:",s)})},h=()=>{g.info("Network offline detected"),this.onConnectionChange?.("disconnected")};window.addEventListener("online",i),window.addEventListener("offline",h),this.networkListeners={handleOnline:i,handleOffline:h}}startConnectionMonitor(){this.connectionMonitorInterval=setInterval(()=>{this.checkConnectionHealth()},3e4)}checkConnectionHealth(){if(this.isReconnecting)return;const i=this.connectedRelays.size,h=this.relays.length;i===0?(g.warn("No healthy relays, triggering reconnect"),this.onConnectionChange?.("disconnected"),this.handleFullReconnect()):i<h*.5&&(g.warn(`Low relay health: ${i}/${h}, reconnecting failed relays`),this.reconnectFailedRelays())}async handleNetworkReconnect(){this.isReconnecting||await this.handleFullReconnect()}async handleFullReconnect(){if(!this.isReconnecting){this.isReconnecting=!0,g.info("Starting full reconnect"),this.onConnectionChange?.("connecting");try{const i=this.lastEventTimestamp||Math.floor(Date.now()/1e3)-300;this.connectedRelays.clear(),this.subscriptions.forEach(r=>{try{r.close()}catch(o){g.warn("Error closing subscription:",o)}}),this.subscriptions.clear();const h=this.relays.filter(r=>!this.connectedRelays.has(r));this.connectedRelays.clear();const s=h.map(async(r,o)=>{try{const e=await this.pool.ensureRelay(r);return this.connectedRelays.add(r),e}catch(e){return g.warn("Failed to reconnect to relay:",r,e),this.scheduleReconnect(r,5e3),null}});await Promise.allSettled(s),g.info(`Reconnection results: ${this.connectedRelays.size}/${this.relays.length} relays connected`),this.connectedRelays.size>0?(g.info(`Successfully reconnected to ${this.connectedRelays.size} relays`),this.onConnectionChange?.("connected"),await this.restartSubscriptions(),await this.fetchMissedEvents(i)):(g.error("Failed to reconnect to any relays"),this.onConnectionChange?.("disconnected"))}catch(i){g.error("Full reconnect failed:",i),this.onConnectionChange?.("disconnected")}finally{this.isReconnecting=!1}}}async restartSubscriptions(){}async reconnectFailedRelays(){const h=this.relays.filter(s=>!this.connectedRelays.has(s)).map(async s=>{try{const r=await this.pool.ensureRelay(s);return this.connectedRelays.add(s),r}catch{return g.warn("Still failed to reconnect:",s),this.scheduleReconnect(s,1e4),null}});await Promise.allSettled(h)}scheduleReconnect(i,h){const s=this.reconnectTimeouts.get(i);s&&clearTimeout(s);const r=setTimeout(async()=>{try{const o=await this.pool.ensureRelay(i);this.connectedRelays.add(i),this.reconnectTimeouts.delete(i)}catch{g.warn("Scheduled reconnect failed:",i),this.scheduleReconnect(i,Math.min(h*1.5,6e4))}},h);this.reconnectTimeouts.set(i,r)}async fetchMissedEvents(i){try{const h=this.pool.subscribeMany(Array.from(this.connectedRelays),[{kinds:[1,5,7],"#app":["nostr-social-feed"],since:i,limit:50}],{onevent:o=>{},oneose:()=>{h.close()}}),s=setTimeout(()=>{h.close()},1e4),r=h.close;h.close=()=>{clearTimeout(s),r.call(h)}}catch(h){g.error("Error fetching missed events:",h)}}async waitForInitialConnection(i=1e4){let s=0;for(;s<i&&this.connectedRelays.size===0;)await new Promise(r=>setTimeout(r,500)),s+=500;this.connectedRelays.size===0&&(g.warn("No relays connected after waiting, forcing reconnect"),await this.handleFullReconnect())}}class Yr{currentLanguage="ru";constructor(){this.currentLanguage=this.getStoredLanguage()}setLanguage(i){this.currentLanguage=i,localStorage.setItem("app_language",i),g.info("Language changed to:",i)}getLanguage(){return this.currentLanguage}getStoredLanguage(){const i=localStorage.getItem("app_language");return i&&rr.some(h=>h.code===i)?i:Jr()}t(i){return nt(this.currentLanguage,i)}getFilterLabel(i){return nt(this.currentLanguage,`filters.${i}.label`,i)}getFilterOptions(i){return Ur(this.currentLanguage,i)}}const Zr=Vr((u,i,h,s,r)=>{let o=[...u];switch(i.sort){case"my":o=o.filter(e=>e.authorKey===r);break;case"favorites":o=o.filter(e=>h.includes(e.id));break;case"hidden":o=o.filter(e=>s.includes(e.id));break;default:o=o.filter(e=>!s.includes(e.id));break}if(i.city&&i.city!=="all"&&(o=o.filter(e=>e.authorInfo.city===i.city)),i.tag&&i.tag!=="all"&&(o=o.filter(e=>e.tag===i.tag)),i.gender&&i.gender!=="all"&&(o=o.filter(e=>e.authorInfo.gender===i.gender)),i.searchQuery?.trim()){const e=i.searchQuery.toLowerCase();o=o.filter(n=>n.title.toLowerCase().includes(e)||n.content.toLowerCase().includes(e))}switch((i.dateRange?.from||i.dateRange?.to)&&(o=o.filter(e=>{const n=new Date(e.timestamp);return!(i.dateRange.from&&n<i.dateRange.from||i.dateRange.to&&n>i.dateRange.to)})),i.sort){case"popular":o.sort((e,n)=>n.likes.length-e.likes.length);break;case"old":o.sort((e,n)=>e.timestamp-n.timestamp);break;case"new":default:o.sort((e,n)=>n.timestamp-e.timestamp);break}return o}),P=yr((u,i)=>{const h=Qr(s=>{u({debouncedSearchQuery:s}),i().applyFilters()},300);return{nostr:new Xr,i18n:new Yr,language:"ru",reports:new Map,connectionStatus:"connecting",isInitialized:!1,showLanguageSelector:!1,showCreatePost:!1,openMenuId:null,isLoading:!0,isCreatingPost:!1,notifications:[],activeModal:null,activeDropdown:null,posts:[],allPosts:[],filteredPosts:[],paginatedPosts:[],pagination:{currentPage:1,itemsPerPage:50,totalItems:0,hasMore:!0},likes:new Map,currentFilters:{city:"all",tag:"all",gender:"all",sort:"new",searchQuery:"",dateRange:{from:null,to:null}},debouncedSearchQuery:"",favorites:[],hidden:[],telegramUser:null,setActiveModal:s=>{u({activeModal:s})},setActiveDropdown:s=>{u({activeDropdown:s})},setShowCreatePost:s=>{u({showCreatePost:s})},closeAllMenus:()=>{u({activeDropdown:null,openMenuId:null,showCreatePost:!1})},initialize:async()=>{const{nostr:s,i18n:r}=i();try{const o=r.getLanguage();u({language:o}),localStorage.getItem("app_language")||u({showLanguageSelector:!0});const n=s.getTelegramUser();n&&(u({telegramUser:n}),g.info("Telegram user loaded:",n.first_name));const t=localStorage.getItem("favorites"),a=localStorage.getItem("hidden");t&&u({favorites:JSON.parse(t)}),a&&u({hidden:JSON.parse(a)}),u({connectionStatus:"connecting"}),s.setConnectionCallback(f=>{g.info("Connection status changed to:",f),u({connectionStatus:f}),f==="connected"&&(g.info("Reconnected - restarting subscriptions"),i().startSubscriptions())}),await s.connect(),s.getConnectedRelays().length>0?(u({connectionStatus:"connected"}),g.info("Nostr initialization complete"),i().startSubscriptions()):(u({connectionStatus:"disconnected"}),g.error("Failed to connect to any Nostr relays")),u({isInitialized:!0,isLoading:!1})}catch(o){g.error("App initialization failed:",o),u({connectionStatus:"disconnected",isLoading:!1})}},startSubscriptions:()=>{const{nostr:s}=i();s.subscribeToFeed(r=>{i().handleNewPost(r)},r=>{i().handleDeletePost(r)}),s.subscribeToLikes(r=>{i().handleNewLike(r)})},handleNewPost:s=>{try{const r=s.tags.find(k=>k[0]==="title"),o=s.tags.find(k=>k[0]==="t"),e=s.tags.find(k=>k[0]==="city"),n=s.tags.find(k=>k[0]==="gender"),t=s.tags.find(k=>k[0]==="lang"),a=s.tags.find(k=>k[0]==="author_name"),f=s.tags.find(k=>k[0]==="author_photo"),c=s.tags.find(k=>k[0]==="author_type"),l=s.tags.find(k=>k[0]==="author_username"),d=s.tags.find(k=>k[0]==="author_email"),_=s.tags.find(k=>k[0]==="profile_link"),v=s.content.split(`

`),y=r?.[1]||v[0]||"Untitled",b=v.slice(1).join(`

`)||s.content,m=a?.[1]||`User_${s.pubkey.slice(-6)}`,j={id:s.id,title:y,content:b,author:m,authorKey:s.pubkey,authorInfo:{name:m,photo_url:f?.[1]||"",city:e?.[1]||"",gender:n?.[1],username:l?.[1]||"",email:d?.[1]||"",account_type:c?.[1]||"demo",profile_link:_?.[1]},tag:o?.[1]||"general",timestamp:s.created_at*1e3,likes:[],replies:[],reports:[],isDraft:!1,language:t?.[1]||"ru"},C=i().allPosts,H=C.findIndex(k=>k.id===s.id);H>=0?C[H]=j:C.unshift(j),u({allPosts:[...C]}),i().applyFilters()}catch(r){g.error("Error processing post event:",r)}},handleNewLike:s=>{try{const r=s.tags.find(d=>d[0]==="e");if(!r)return;const o=r[1],e=s.pubkey,t=s.tags.find(d=>d[0]==="action")?.[1]==="unlike"||s.content==="",a=i().likes,f=a.get(o)||[];if(t){const d=f.filter(_=>_!==e);a.set(o,d)}else f.includes(e)||a.set(o,[...f,e]);u({likes:new Map(a)});const c=i().allPosts,l=c.findIndex(d=>d.id===o);l>=0&&(c[l].likes=a.get(o)||[],u({allPosts:[...c]}),i().applyFilters())}catch(r){g.error("Error processing like event:",r)}},handleDeletePost:s=>{try{s.tags.filter(o=>o[0]==="e").forEach(o=>{const e=o[1];if(e){const n=i().allPosts,t=n.filter(l=>l.id!==e),a=i().likes;a.delete(e);const f=i().favorites.filter(l=>l!==e),c=i().hidden.filter(l=>l!==e);n.length!==t.length&&(u({allPosts:t,likes:new Map(a),favorites:f,hidden:c}),localStorage.setItem("favorites",JSON.stringify(f)),localStorage.setItem("hidden",JSON.stringify(c)),i().applyFilters())}})}catch(r){g.error("Error processing delete event:",r)}},setLanguage:s=>{const{i18n:r}=i();r.setLanguage(s),u({language:s})},setShowLanguageSelector:s=>{u({showLanguageSelector:s})},createPost:async(s,r,o)=>{const{nostr:e,language:n,i18n:t}=i();u({isCreatingPost:!0});try{const a=e.getUserInfo();if(!a)throw new Error("No user data available for post creation");const f={name:a.name,photo_url:a.photo_url,username:a.username,email:a.email,city:"moscow",gender:"male",language:n};await e.publishPost(s,r,o,f),i().showNotification("success",t.t("posts.form.published")),g.info("Post created successfully")}catch(a){g.error("Failed to create post:",a);const f=a instanceof Error?a.message:t.t("posts.form.error");throw i().showNotification("error",f),a}finally{u({isCreatingPost:!1})}},toggleLike:async(s,r)=>{const{nostr:o,likes:e,i18n:n}=i(),t=e.get(s)||[],a=o.getPublicKey(),f=t.includes(a),c=f?t.filter(l=>l!==a):[...t,a];e.set(s,c),u({likes:new Map(e)});try{await o.publishLike(s,r,f)}catch(l){e.set(s,t),u({likes:new Map(e)}),g.error("Failed to toggle like:",l),i().showNotification("error",n.t("status.likeError"))}},setFilter:(s,r)=>{const o=i().currentFilters;u({currentFilters:{...o,[s]:r}}),i().applyFilters()},setSearchQuery:s=>{const r=i().currentFilters;u({currentFilters:{...r,searchQuery:s}}),h(s)},resetFilters:()=>{u({currentFilters:{city:"all",tag:"all",gender:"all",sort:"new",searchQuery:"",dateRange:{from:null,to:null}},debouncedSearchQuery:"",pagination:{currentPage:1,itemsPerPage:50,totalItems:0,hasMore:!0}}),i().applyFilters()},resetSortOnly:()=>{const s=i().currentFilters;u({currentFilters:{...s,sort:"new"}}),i().applyFilters()},toggleFavorite:s=>{const{favorites:r}=i(),o=r.includes(s)?r.filter(e=>e!==s):[...r,s];u({favorites:o}),localStorage.setItem("favorites",JSON.stringify(o)),i().currentFilters.sort==="favorites"&&i().applyFilters()},isMyPost:s=>{const{nostr:r}=i();return r.isMyPost(s)},hidePost:s=>{const{hidden:r}=i(),o=r.includes(s)?r.filter(e=>e!==s):[...r,s];u({hidden:o}),localStorage.setItem("hidden",JSON.stringify(o)),i().applyFilters()},setOpenMenu:s=>{u({openMenuId:s})},reportPost:async(s,r)=>{const{nostr:o,reports:e}=i();try{const n=o.getPublicKey(),t=e.get(s)||[];if(t.find(f=>f.userId===n))return;await o.publishReport(s,r),t.push({userId:n,reason:r,timestamp:Date.now()}),e.set(s,t),u({reports:new Map(e)}),t.length>=5&&(g.info("Post hidden due to reports:",s),i().hidePost(s)),g.info("Report submitted successfully")}catch(n){g.error("Failed to report post:",n)}},deletePost:async s=>{const{nostr:r}=i();try{await r.deletePost(s);const e=i().allPosts.filter(n=>n.id!==s);u({allPosts:e}),i().applyFilters(),g.info("Delete event published, post removed locally")}catch(o){g.error("Failed to delete post:",o)}},applyFilters:()=>{const{allPosts:s,currentFilters:r,debouncedSearchQuery:o,favorites:e,hidden:n,nostr:t}=i(),a={...r,searchQuery:o},f=Zr(s,a,e,n,t.getPublicKey()),c=f.length,{itemsPerPage:l,currentPage:d}=i().pagination,v=(d-1)*l+l,y=f.slice(0,v),b=v<c;u({filteredPosts:f,paginatedPosts:y,pagination:{...i().pagination,totalItems:c,hasMore:b}})},loadMorePosts:()=>{const{pagination:s,filteredPosts:r}=i(),o=s.currentPage+1,e=o*s.itemsPerPage,n=r.slice(0,e),t=e<r.length;u({paginatedPosts:n,pagination:{...s,currentPage:o,hasMore:t}})},showNotification:(s,r)=>{const o={id:`${Date.now()}_${Math.random()}`,type:s,message:r,timestamp:Date.now()},e=i().notifications;u({notifications:[...e,o]}),setTimeout(()=>{i().dismissNotification(o.id)},5e3)},dismissNotification:s=>{const r=i().notifications;u({notifications:r.filter(o=>o.id!==s)})},cleanup:()=>{const{nostr:s}=i();s.cleanup(),g.info("App store cleaned up")}}}),en=async()=>{g.info("Initializing Nostr Social App"),await P.getState().initialize()},$=()=>{const{i18n:u,language:i}=P();return{t:u.t.bind(u),language:i,getFilterLabel:u.getFilterLabel.bind(u),getFilterOptions:u.getFilterOptions.bind(u)}},nr=()=>{const{connectionStatus:u,nostr:i}=P();return{connectionStatus:u,connectedRelays:i.getConnectedRelays(),publicKey:i.getPublicKey(),npub:i.getNpub()}},tn=()=>{const{showLanguageSelector:u,setShowLanguageSelector:i,setLanguage:h,language:s}=P(),{t:r}=$(),o=e=>{h(e),i(!1)};return p.jsx(Me,{isOpen:u,onClose:()=>i(!1),title:r("ui.languageSelection"),size:"sm",children:p.jsxs("div",{className:"space-y-4",children:[p.jsx("p",{className:"text-tetra-sm text-zen-600 leading-zen",children:r("ui.selectLanguage")}),p.jsx("div",{className:"space-y-2",children:rr.map(e=>p.jsxs("button",{onClick:()=>o(e.code),className:`w-full flex items-center justify-between p-4 
                         border-2 rounded-zen-lg transition-all duration-zen
                         ${s===e.code?"border-primary-500 bg-primary-50":"border-zen-200 hover:border-zen-300 hover:bg-zen-50"}`,children:[p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx("span",{className:`font-medium ${s===e.code?"text-primary-700":"text-zen-900"}`,children:e.nativeName}),p.jsx("span",{className:"text-tetra-sm text-zen-500",children:e.name})]}),s===e.code&&p.jsx(Vt,{className:"w-5 h-5 text-primary-600"})]},e.code))}),p.jsx("div",{className:"mt-6 p-3 bg-blue-50 rounded-zen border border-blue-200",children:p.jsx("p",{className:"text-tetra-xs text-blue-700 text-center",children:"ðŸ“ More languages coming soon!"})})]})})},ot=({filterId:u,isOpen:i,onClose:h,limitedOptions:s})=>{const[r,o]=S.useState(""),{currentFilters:e,setFilter:n}=P(),{t,getFilterLabel:a,getFilterOptions:f}=$(),c=a(u),l=f(u),d=e[u]||"all",_=s?l.filter(m=>s.includes(m.id)||m.id==="all"):l,v=u==="city"&&r.trim()?_.filter(m=>m.name.toLowerCase().includes(r.toLowerCase())):_,y=m=>{n(u,m),o(""),h()},b=()=>{o(""),h()};return p.jsx(Me,{isOpen:i,onClose:b,title:c,size:"sm",children:p.jsxs("div",{className:"space-y-4",children:[u==="city"&&p.jsx(Re,{placeholder:t(`filters.${u}.placeholder`)||t("ui.search"),value:r,onChange:m=>o(m.target.value),icon:p.jsx(Xt,{className:"w-4 h-4"})}),p.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto scrollbar-hidden",children:v.length===0?p.jsx("div",{className:"text-center py-8 text-zen-500",children:t("status.noPostsFound")}):v.map(m=>p.jsxs("button",{onClick:()=>y(m.id),className:`w-full flex items-center justify-between p-3
                           border-2 rounded-zen transition-all duration-zen
                           ${d===m.id?"border-primary-500 bg-primary-50":"border-zen-200 hover:border-zen-300 hover:bg-zen-50"}`,children:[p.jsxs("div",{className:"flex items-center space-x-3",children:[m.icon&&p.jsx("span",{className:"text-tetra-lg",children:m.icon}),p.jsx("span",{className:`font-medium ${d===m.id?"text-primary-700":"text-zen-900"}`,children:m.name})]}),d===m.id&&p.jsx(Vt,{className:"w-5 h-5 text-primary-600"})]},m.id))})]})})},rn=({isOpen:u,onClose:i,onReport:h,postId:s})=>{const[r,o]=S.useState(""),{t:e,language:n}=$(),t=Gr(n),a=()=>{r&&(h(r),o(""),i())},f=()=>{o(""),i()};return p.jsx(Me,{isOpen:u,onClose:f,title:e("reports.title"),size:"sm",children:p.jsxs("div",{className:"space-y-4",children:[p.jsx("p",{className:"text-tetra-sm text-zen-600 leading-zen",children:e("reports.subtitle")}),p.jsx("div",{className:"space-y-2",children:t.map(c=>p.jsxs("button",{onClick:()=>o(c.id),className:`w-full flex items-center space-x-3 p-3
                         border-2 rounded-zen transition-all duration-zen
                         ${r===c.id?"border-red-500 bg-red-50":"border-zen-200 hover:border-zen-300 hover:bg-zen-50"}`,children:[p.jsx("span",{className:"text-tetra-lg",children:c.icon}),p.jsx("span",{className:`font-medium ${r===c.id?"text-red-700":"text-zen-900"}`,children:c.name})]},c.id))}),p.jsxs("div",{className:"flex space-x-3 pt-4",children:[p.jsx(O,{variant:"secondary",onClick:f,className:"flex-1",children:e("reports.cancel")}),p.jsx(O,{variant:"danger",onClick:a,disabled:!r,className:"flex-1",children:e("reports.submit")})]})]})})},nn=({isOpen:u,onClose:i,onConfirm:h,title:s,message:r,confirmText:o="Confirm",cancelText:e="Cancel",variant:n="default"})=>{const t=()=>{h(),i()};return p.jsx(Me,{isOpen:u,onClose:i,title:s,size:"sm",children:p.jsxs("div",{className:"space-y-4",children:[p.jsx("p",{className:"text-zen-700 leading-zen",children:r}),p.jsxs("div",{className:"flex space-x-3 pt-4",children:[p.jsx(O,{variant:"secondary",onClick:i,className:"flex-1",children:e}),p.jsx(O,{variant:n==="danger"?"danger":"primary",onClick:t,className:"flex-1",children:o})]})]})})},or=({isOpen:u,onClose:i,position:h,items:s})=>u?p.jsx(Ie,{children:p.jsx("div",{className:"dropdown-zen","data-menu":!0,style:{position:"fixed",top:`${h.top}px`,left:`${h.left}px`,pointerEvents:"auto"},children:s.map((r,o)=>p.jsxs(de.Fragment,{children:[p.jsxs("button",{"data-menu":!0,onClick:e=>{e.stopPropagation(),r.disabled||(r.onClick(),i())},disabled:r.disabled,className:`w-full flex items-center space-x-3 px-4 py-3 text-left
                         transition-colors duration-zen
                         ${r.disabled?"opacity-50 cursor-not-allowed":"hover:bg-zen-50 cursor-pointer"}
                         ${r.variant==="danger"?"text-red-600 hover:bg-red-50":"text-zen-700"}
                         ${o===0?"rounded-t-zen-lg":""}
                         ${o===s.length-1?"rounded-b-zen-lg":""}
                      `,children:[r.icon&&p.jsx("div",{className:"w-4 h-4 flex-shrink-0",children:r.icon}),p.jsx("span",{className:"text-tetra-sm font-medium",children:r.label})]}),o<s.length-1&&p.jsx("div",{className:"border-t border-zen-100"})]},r.id))})}):null,on=({post:u})=>{const[i,h]=S.useState(!1),[s,r]=S.useState(!1),[o,e]=S.useState({top:0,left:0}),n=S.useRef(null),{toggleLike:t,toggleFavorite:a,hidePost:f,favorites:c,hidden:l,openMenuId:d,setOpenMenu:_,reportPost:v,deletePost:y}=P(),{publicKey:b}=nr(),{t:m}=$(),j=u.authorKey===b,C=u.likes?.includes(b),H=u.likes?.length||0,k=c.includes(u.id),fe=l.includes(u.id),x=d===u.id;de.useEffect(()=>{const w=D=>{!D.target.closest("[data-menu]")&&x&&_(null)};return x&&document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[x,_]);const I=w=>new Date(w).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),R=()=>{u.authorInfo?.profile_link&&(u.authorInfo.account_type==="telegram"?u.authorInfo?.profile_link?.startsWith("https://t.me/")&&window.open(u.authorInfo.profile_link,"_blank","noopener,noreferrer"):u.authorInfo.account_type==="google"&&(window.location.href=u.authorInfo.profile_link))},K=w=>{if(w.stopPropagation(),x)_(null);else{const D=n.current?.getBoundingClientRect();if(D){let qe=D.top-200-8,he=D.right-180;qe<20&&(qe=D.bottom+8),he<20&&(he=20),he+180>window.innerWidth-20&&(he=window.innerWidth-180-20),e({top:qe,left:he})}_(u.id)}},U=j?[{id:"edit",label:m("posts.actions.edit"),icon:p.jsx(br,{className:"w-4 h-4"}),onClick:()=>console.log("Edit post:",u.id)},{id:"delete",label:m("posts.actions.delete"),icon:p.jsx(xr,{className:"w-4 h-4"}),onClick:()=>r(!0),variant:"danger"}]:[{id:"favorite",label:m(k?"ui.removeFromFavorites":"ui.favorite"),icon:p.jsx(Yt,{className:`w-4 h-4 ${k?"fill-current text-amber-500":""}`}),onClick:()=>a(u.id)},{id:"hide",label:m(fe?"ui.showMore":"ui.hide"),icon:p.jsx(Zt,{className:"w-4 h-4"}),onClick:()=>f(u.id)},{id:"report",label:m("ui.report"),icon:p.jsx(wr,{className:"w-4 h-4"}),onClick:()=>h(!0),variant:"danger"}];return p.jsxs(p.Fragment,{children:[p.jsxs(er,{className:"post-zen",children:[p.jsx("div",{className:"post-meta",children:I(u.timestamp)}),p.jsx("h3",{className:"post-title",children:u.title}),p.jsx("p",{className:"post-content",children:u.content}),p.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx(tr,{src:u.authorInfo?.photo_url,name:u.authorInfo?.name||u.author,onClick:R,className:u.authorInfo?.profile_link?"interactive":""}),p.jsxs("div",{className:"min-w-0 flex-1",children:[p.jsx("div",{className:`font-medium text-zen-900 text-overflow ${u.authorInfo?.profile_link?"cursor-pointer hover:text-primary-600":""}`,onClick:R,children:u.authorInfo?.name||u.author}),u.authorInfo?.city&&p.jsx("div",{className:"post-meta text-overflow",children:u.authorInfo.city})]})]}),p.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[p.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>t(u.id,u.authorKey),className:`${C?"text-red-500 hover:text-red-600":"text-zen-500"}`,children:[p.jsx(jr,{className:`w-4 h-4 mr-1 ${C?"fill-current":""}`}),H]}),p.jsx(O,{ref:n,variant:"ghost",size:"sm",onClick:K,children:p.jsx(kr,{className:"w-4 h-4"})})]})]})]}),p.jsx(or,{isOpen:x,onClose:()=>_(null),position:o,items:U}),p.jsx(rn,{isOpen:i,onClose:()=>h(!1),onReport:w=>v(u.id,w),postId:u.id}),p.jsx(nn,{isOpen:s,onClose:()=>r(!1),onConfirm:()=>y(u.id),title:m("posts.actions.delete"),message:m("posts.actions.confirmDelete"),confirmText:m("ui.delete"),cancelText:m("ui.cancel"),variant:"danger"})]})},sn=()=>{const[u,i]=S.useState(""),[h,s]=S.useState(""),[r,o]=S.useState("general"),[e,n]=S.useState("moscow"),[t,a]=S.useState("male"),[f,c]=S.useState(!1),[l,d]=S.useState(!1),{createPost:_,telegramUser:v,isCreatingPost:y,showCreatePost:b,setShowCreatePost:m}=P(),{t:j,getFilterOptions:C}=$(),H=C("tag").filter(w=>w.id!=="all"),k=[{value:"moscow",label:j("posts.cities.moscow")},{value:"petersburg",label:j("posts.cities.petersburg")},{value:"novosibirsk",label:j("posts.cities.novosibirsk")},{value:"ekaterinburg",label:j("posts.cities.ekaterinburg")},{value:"kazan",label:j("posts.cities.kazan")},{value:"nizhny",label:j("posts.cities.nizhny")}],fe=[{value:"male",label:j("posts.genders.male")},{value:"female",label:j("posts.genders.female")}],x=async w=>{if(w.preventDefault(),!(!u.trim()||!h.trim()||y))try{await _(u.trim(),h.trim(),r),c(!0),setTimeout(()=>c(!1),3e3),i(""),s(""),o("general"),n("moscow"),a("male"),R()}catch(D){console.error("âŒ Post creation failed:",D)}},I=u.trim()&&h.trim(),R=()=>{d(!0),setTimeout(()=>{m(!1),d(!1)},382)},K=w=>{w.target===w.currentTarget&&R()},U=w=>{w.stopPropagation()};return b?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"fixed inset-0 bg-black/20 z-modal",onClick:K}),p.jsx("div",{className:"fixed top-0 left-0 right-0 z-modal",children:p.jsx("div",{className:l?"animate-slide-out":"animate-slide-zen",children:p.jsxs(er,{className:"mx-3 mt-3 mb-3 px-3 pb-3 space-y-4 relative",onClick:U,children:[v&&p.jsxs("div",{className:"flex items-center justify-between pt-3",children:[p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx(tr,{src:v?.photo_url,name:`${v.first_name} ${v.last_name||""}`}),p.jsxs("span",{className:"font-semibold text-zen-900",children:[v.first_name," ",v.last_name||""]})]}),p.jsx(O,{onClick:x,disabled:!I||y,loading:y,size:"sm",children:p.jsx(mr,{className:"w-4 h-4"})})]}),p.jsxs("form",{onSubmit:x,className:"space-y-4",children:[p.jsx(Re,{placeholder:j("posts.form.titlePlaceholder")||j("ui.title"),value:u,onChange:w=>i(w.target.value),disabled:y,maxLength:100}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsx(Ae,{options:k,value:e,onChange:n,disabled:y}),p.jsx(Ae,{options:fe,value:t,onChange:w=>a(w),disabled:y})]}),p.jsx(Hr,{placeholder:j("posts.form.contentPlaceholder")||j("ui.description"),value:h,onChange:w=>s(w.target.value),disabled:y,maxLength:500,rows:4}),p.jsx(Ae,{options:H.map(w=>({value:w.id,label:w.name,icon:w.icon})),value:r,onChange:o,disabled:y})]}),y&&p.jsx("div",{className:"absolute inset-0 bg-white/80 rounded-zen-lg center-zen",children:p.jsxs("div",{className:"flex items-center space-x-3 text-primary-600",children:[p.jsx(je,{variant:"primary"}),p.jsx("span",{className:"font-medium",children:j("posts.form.publishing")})]})})]})})}),f&&p.jsxs("div",{className:"fixed top-5 right-5 notification-success z-notification",children:[p.jsx(Ye,{className:"w-5 h-5"}),p.jsx("span",{children:j("posts.form.published")})]})]}):p.jsx(p.Fragment,{children:f&&p.jsxs("div",{className:"fixed top-5 right-5 notification-success z-notification",children:[p.jsx(Ye,{className:"w-5 h-5"}),p.jsx("span",{children:j("posts.form.published")})]})})},Ne=({filterId:u,showSelected:i=!0,limitedOptions:h,variant:s="default"})=>{const[r,o]=S.useState(!1),{currentFilters:e,activeModal:n,setActiveModal:t}=P(),{t:a,getFilterLabel:f,getFilterOptions:c}=$(),l=f(u),d=c(u),_=e[u]||"all",v=d.find(C=>C.id===_),y=`filter-${u}`,b=n===y,m=C=>{C&&C.stopPropagation(),t(b?null:y)},j=()=>{switch(u){case"city":return"ðŸ“";case"tag":return"ðŸ·ï¸";case"gender":return"ðŸ‘¥";case"sort":return _==="popular"?"ðŸ“ˆ":_==="old"?"ðŸ“Š":"ðŸ•’";default:return""}};return s==="simple"?p.jsxs(p.Fragment,{children:[p.jsxs("button",{onClick:m,"data-menu":!0,className:`flex items-center space-x-2 p-2 hover:bg-zen-50 \r
                     rounded-zen transition-colors duration-zen text-left w-full`,children:[p.jsx("span",{className:"text-tetra-sm",children:j()}),p.jsx("span",{className:"text-tetra-sm text-zen-700",children:l})]}),p.jsx(ot,{filterId:u,isOpen:b,onClose:()=>t(null),limitedOptions:h})]}):p.jsxs(p.Fragment,{children:[p.jsx(O,{variant:"ghost",size:"sm",onClick:m,className:`filter-button ${_!=="all"&&i?"filter-button-active":""}`,children:p.jsxs("div",{className:"flex items-center space-x-2",children:[v?.icon&&p.jsx("span",{className:"text-tetra-sm",children:v.icon}),p.jsxs("div",{className:"text-left",children:[p.jsx("div",{className:"text-tetra-sm",children:l}),i&&_!=="all"&&p.jsx("div",{className:"text-tetra-xs text-zen-500",children:a("filters.selected")})]})]})}),p.jsx(ot,{filterId:u,isOpen:b,onClose:()=>t(null),limitedOptions:h})]})},an=()=>{const[u,i]=S.useState({top:0,left:0}),[h,s]=S.useState(!1),r=S.useRef(null),o=S.useRef(null),{currentFilters:e,setSearchQuery:n,resetFilters:t,setShowLanguageSelector:a,setShowCreatePost:f,setFilter:c,activeDropdown:l,setActiveDropdown:d,closeAllMenus:_}=P(),{t:v}=$(),y=l==="main-menu",b=l==="filters-menu",m=[{id:"my",label:v("filters.sort.options.my"),icon:Sr},{id:"favorites",label:v("filters.sort.options.favorites"),icon:Yt},{id:"hidden",label:v("filters.sort.options.hidden"),icon:Zt}];S.useEffect(()=>{const x=()=>{const R=window.screen.height-window.innerHeight;s(R>150)},I=()=>{setTimeout(()=>{s(!1)},300)};return window.addEventListener("resize",x),document.addEventListener("blur",I,!0),()=>{window.removeEventListener("resize",x),document.removeEventListener("blur",I,!0)}},[]),S.useEffect(()=>{const x=I=>{const R=I.target;!R.closest("[data-menu]")&&!R.closest(".modal-backdrop")&&setTimeout(()=>{d(null)},100)};return(y||b)&&document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[y,b,d]);const j=x=>{n(x.target.value)},C=x=>{if(!x.current)return{top:0,left:0};const I=x.current.getBoundingClientRect(),R=300,K=200;let U=I.top-R-8,w=I.right-K;return U<20&&(U=I.bottom+8),w<20&&(w=20),w+K>window.innerWidth-20&&(w=window.innerWidth-K-20),{top:U,left:w}},H=()=>{if(h)document.activeElement?.blur(),setTimeout(()=>{const x=C(r);i(x),d(b?null:"filters-menu")},300);else{const x=C(r);i(x),d(b?null:"filters-menu")}},k=()=>{if(h)document.activeElement?.blur(),setTimeout(()=>{const x=C(o);i(x),d(y?null:"main-menu")},300);else{const x=C(o);i(x),d(y?null:"main-menu")}},fe=[{id:"create-post",label:v("ui.createPost"),icon:p.jsx(Cr,{className:"w-4 h-4"}),onClick:()=>f(!0)},...m.map(x=>({id:x.id,label:x.label,icon:p.jsx(x.icon,{className:"w-4 h-4"}),onClick:()=>c("sort",x.id)})),{id:"show-all",label:"Ð’ÑÐµ Ð·Ð°Ð¿Ð¸ÑÐ¸",icon:p.jsx(Nr,{className:"w-4 h-4"}),onClick:()=>{c("sort","new")}},{id:"language",label:v("ui.changeLanguage"),icon:p.jsx(Er,{className:"w-4 h-4"}),onClick:()=>a(!0)}];return v("filters.resetAll"),Ze,p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"floating-filters fixed bottom-0 left-0 right-0 z-dropdown center-x safe-bottom",children:p.jsx("div",{className:`bg-transparent backdrop-blur-[3px] p-3 m-4 rounded-zen-xl \r
                          w-full max-w-content border border-white/50`,children:p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx("div",{className:"flex-1","data-menu":!0,children:p.jsx(Re,{ref:searchInputRef,value:e.searchQuery||"",onChange:j,icon:p.jsx(Xt,{className:"w-4 h-4"}),className:"bg-transparent border-white/30"})}),p.jsx(O,{ref:r,variant:"ghost",size:"sm",onClick:H,"data-menu":!0,className:"glass-zen",children:p.jsx(Or,{className:"w-4 h-4"})}),p.jsx(O,{ref:o,variant:"ghost",size:"sm",onClick:k,"data-menu":!0,className:"glass-zen",children:p.jsx(Pr,{className:"w-4 h-4"})})]})})}),b&&p.jsxs(Ie,{children:[p.jsx("div",{className:"fixed inset-0 z-dropdown",onClick:()=>d(null)}),p.jsx("div",{className:"dropdown-zen glass-zen",style:{position:"fixed",top:`${u.top}px`,left:`${u.left}px`,pointerEvents:"auto"},children:p.jsxs("div",{className:"p-3 space-y-2",children:[p.jsx("div",{onClick:x=>x.stopPropagation(),children:p.jsx(Ne,{filterId:"city",variant:"simple"})}),p.jsx("div",{onClick:x=>x.stopPropagation(),children:p.jsx(Ne,{filterId:"tag",variant:"simple"})}),p.jsx("div",{onClick:x=>x.stopPropagation(),children:p.jsx(Ne,{filterId:"gender",variant:"simple"})}),p.jsx("div",{className:"border-t border-zen-200 my-2"}),p.jsx("div",{onClick:x=>x.stopPropagation(),children:p.jsx(Ne,{filterId:"sort",variant:"simple",limitedOptions:["popular","new","old"]})}),p.jsx("div",{className:"border-t border-zen-200 my-2"}),p.jsxs("button",{onClick:()=>{t(),d(null)},className:`flex items-center space-x-2 p-2 w-full text-left\r
                       text-red-600 hover:bg-red-50 rounded-zen transition-colors`,children:[p.jsx(Ze,{className:"w-4 h-4"}),p.jsx("span",{className:"text-tetra-sm",children:v("filters.resetAll")})]})]})})]}),p.jsx(or,{isOpen:y,onClose:()=>d(null),position:u,items:fe})]})},cn=()=>{const{connectionStatus:u}=nr(),{t:i}=$();return u==="connected"?null:p.jsx("div",{className:"notification-warning mb-4",children:u==="disconnected"?p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsxs("div",{className:"flex items-center space-x-2 text-amber-600",children:[p.jsx(Ir,{className:"w-5 h-5"}),p.jsx(Oe,{className:"w-4 h-4"})]}),p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"font-semibold text-amber-800",children:i("ui.disconnected")}),p.jsx("p",{className:"text-tetra-sm text-amber-700",children:"ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚-ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"})]}),p.jsxs("div",{className:"flex items-center space-x-2 text-amber-600",children:[p.jsx(je,{size:"sm"}),p.jsx("span",{className:"text-tetra-xs italic",children:"ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ..."})]})]}):p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx(je,{variant:"primary"}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-amber-800",children:i("ui.connecting")}),p.jsx("p",{className:"text-tetra-sm text-amber-700",children:"ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÑÐµÑ‚Ð¸ Nostr..."})]})]})})},ln=({height:u=600})=>{const{paginatedPosts:i,loadMorePosts:h,pagination:s,connectionStatus:r}=P(),{t:o}=$(),[e,n]=S.useState(!1),t=S.useRef(null),a=S.useCallback(f=>{const c=f.currentTarget;c.scrollTop/(c.scrollHeight-c.clientHeight)>.8&&s.hasMore&&!e&&(n(!0),h(),setTimeout(()=>n(!1),1e3))},[h,s.hasMore,e]);return S.useEffect(()=>{t.current&&(t.current.scrollTop=0)},[i.length]),r!=="connected"?p.jsx("div",{className:"center-zen text-center p-8 space-y-4",style:{height:`${u}px`},children:r==="connecting"?p.jsxs(p.Fragment,{children:[p.jsx(je,{size:"lg",variant:"primary"}),p.jsx("p",{className:"text-zen-600",children:o("status.connecting")})]}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"w-12 h-12 bg-zen-100 rounded-full center-zen text-tetra-2xl",children:"ðŸ“¡"}),p.jsx("p",{className:"text-zen-600",children:o("status.disconnected")})]})}):i.length===0?p.jsxs("div",{className:"center-zen text-center p-12 space-y-4",style:{height:`${u}px`},children:[p.jsx("div",{className:"text-6xl opacity-50",children:"ðŸ“"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-tetra-lg font-medium text-zen-700 mb-2",children:o("status.noPostsFound")}),p.jsx("p",{className:"text-tetra-sm text-zen-500",children:o("status.changeFilters")})]})]}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{ref:t,onScroll:a,className:"overflow-y-auto scrollbar-hidden",style:{height:`${u}px`},children:[p.jsx("div",{className:"space-y-4",children:i.map(f=>p.jsx("div",{className:"your-wrapper-classes",children:p.jsx(on,{post:f})},f.id))}),e&&s.hasMore&&p.jsx("div",{className:"sticky bottom-5 center-x mt-4",children:p.jsxs("div",{className:"notification-zen bg-primary-600 text-white",children:[p.jsx(je,{size:"sm"}),p.jsx("span",{className:"font-medium",children:o("ui.loading")})]})})]}),p.jsxs("div",{className:"flex items-center justify-between p-4 bg-zen-50 border-t border-zen-200 text-tetra-sm text-zen-600",children:[p.jsxs("div",{children:[p.jsx("span",{className:"font-medium text-zen-900",children:i.length}),p.jsx("span",{children:" / "}),p.jsx("span",{className:"font-medium text-zen-900",children:s.totalItems})]}),s.hasMore&&p.jsx(O,{variant:"primary",size:"sm",onClick:()=>{n(!0),h(),setTimeout(()=>n(!1),1e3)},disabled:e,loading:e,children:o("ui.loadMore")})]})]})},un=()=>{const{notifications:u,dismissNotification:i}=P();return u.length===0?null:p.jsx(Ie,{children:p.jsx("div",{className:"fixed top-5 right-5 z-notification space-y-2 pointer-events-none",children:u.map(h=>{const s=h.type==="success"?"notification-success":h.type==="error"?"notification-error":"notification-warning",r=h.type==="success"?Oe:h.type==="error"?Oe:Oe;return p.jsxs("div",{className:`${s} pointer-events-auto relative overflow-hidden max-w-sm`,children:[p.jsx(r,{className:"w-5 h-5 flex-shrink-0"}),p.jsx("span",{className:"flex-1 text-tetra-sm leading-zen",children:h.message}),p.jsx(O,{variant:"ghost",size:"sm",onClick:()=>i(h.id),className:"p-1 opacity-70 hover:opacity-100",children:p.jsx(Qt,{className:"w-4 h-4"})}),p.jsx("div",{className:"absolute bottom-0 left-0 h-0.5 bg-current opacity-30 animate-[progressFlow_5s_linear_forwards]"})]},h.id)})})})},dn=({children:u})=>p.jsxs("div",{className:"min-h-screen bg-zen-50 safe-top safe-bottom",children:[p.jsx(un,{}),p.jsx(sn,{}),p.jsx("div",{className:"content-area min-h-screen pb-20",children:u}),p.jsx(an,{}),p.jsx(tn,{})]}),fn=()=>p.jsx("div",{className:"min-h-screen center-zen bg-zen-50",children:p.jsxs("div",{className:"text-center space-y-phi",children:[p.jsx("div",{className:"spinner-primary w-10 h-10 mx-auto"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("h2",{className:"text-tetra-xl font-semibold text-zen-900"}),p.jsx("p",{className:"text-tetra-sm text-zen-600"})]})]})}),hn=()=>{const{paginatedPosts:u,isInitialized:i,isLoading:h,connectionStatus:s}=P(),r=s==="connected";if(!i||h)return p.jsx(fn,{});const o=80,e=100,n=r?0:80,t=window.innerHeight-o-e-n-40;return p.jsxs("div",{className:"space-y-4",children:[p.jsx(cn,{}),r&&p.jsx(ln,{height:Math.max(400,t)})]})},pn=()=>{const{cleanup:u,closeAllMenus:i}=P();return S.useEffect(()=>{window.Telegram?.WebApp&&(window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand()),en().catch(o=>{console.error("ðŸš¨ App initialization error:",o)});const h=o=>{const e=o.target;!e.closest("[data-menu]")&&!e.closest("#portal-root")&&i()},s=o=>{o.key==="Escape"&&i()},r=()=>{const o=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${o}px`)};return document.addEventListener("click",h),document.addEventListener("keydown",s),window.addEventListener("resize",r),r(),()=>{document.removeEventListener("click",h),document.removeEventListener("keydown",s),window.removeEventListener("resize",r),u()}},[u,i]),p.jsx(Tr,{children:p.jsx(dn,{children:p.jsx(hn,{})})})};var Te={},_e={},st;function sr(){if(st)return _e;st=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.is_node=void 0;function u(){return h===null&&(h=typeof Pe=="object"&&i(Pe)),h}_e.is_node=u;function i(s){return s!==null&&typeof s.process=="object"&&s.process!==null&&typeof s.process.versions=="object"&&s.process.versions!==null&&typeof s.process.versions.node<"u"}var h=null;return _e}var B={},$e,it;function _n(){if(it)return $e;it=1;var u=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return $e=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return u()}try{return __global__||u()}finally{delete Object.prototype.__global__}}(),$e}const vn="1.0.35",yn={version:vn};var He,at;function gn(){return at||(at=1,He=yn.version),He}var De,ct;function mn(){if(ct)return De;ct=1;var u;if(typeof globalThis=="object")u=globalThis;else try{u=_n()}catch{}finally{if(!u&&typeof window<"u"&&(u=window),!u)throw new Error("Could not determine global this")}var i=u.WebSocket||u.MozWebSocket,h=gn();function s(r,o){var e;return o?e=new i(r,o):e=new i(r),e}return i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(r){Object.defineProperty(s,r,{get:function(){return i[r]}})}),De={w3cwebsocket:i?s:null,version:h},De}var ae={},F={},M={},G={},W={},ve={},lt;function bn(){if(lt)return ve;lt=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.ForOfAdaptor=void 0;var u=function(){function i(h,s){this.it_=h,this.last_=s}return i.prototype.next=function(){if(this.it_.equals(this.last_))return{done:!0,value:void 0};var h=this.it_;return this.it_=this.it_.next(),{done:!1,value:h.value}},i.prototype[Symbol.iterator]=function(){return this},i}();return ve.ForOfAdaptor=u,ve}var ut;function Ge(){if(ut)return W;ut=1;var u=W&&W.__values||function(s){var r=typeof Symbol=="function"&&Symbol.iterator,o=r&&s[r],e=0;if(o)return o.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&e>=s.length&&(s=void 0),{value:s&&s[e++],done:!s}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(W,"__esModule",{value:!0}),W.Container=void 0;var i=bn(),h=function(){function s(){}return s.prototype.empty=function(){return this.size()===0},s.prototype.rbegin=function(){return this.end().reverse()},s.prototype.rend=function(){return this.begin().reverse()},s.prototype[Symbol.iterator]=function(){return new i.ForOfAdaptor(this.begin(),this.end())},s.prototype.toJSON=function(){var r,o,e=[];try{for(var n=u(this),t=n.next();!t.done;t=n.next()){var a=t.value;e.push(a)}}catch(f){r={error:f}}finally{try{t&&!t.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}return e},s}();return W.Container=h,W}var J={},dt;function We(){if(dt)return J;dt=1;var u=J&&J.__read||function(h,s){var r=typeof Symbol=="function"&&h[Symbol.iterator];if(!r)return h;var o=r.call(h),e,n=[],t;try{for(;(s===void 0||s-- >0)&&!(e=o.next()).done;)n.push(e.value)}catch(a){t={error:a}}finally{try{e&&!e.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n};Object.defineProperty(J,"__esModule",{value:!0}),J.NativeArrayIterator=void 0;var i=function(){function h(s,r){this.data_=s,this.index_=r}return h.prototype.index=function(){return this.index_},Object.defineProperty(h.prototype,"value",{get:function(){return this.data_[this.index_]},enumerable:!1,configurable:!0}),h.prototype.prev=function(){return--this.index_,this},h.prototype.next=function(){return++this.index_,this},h.prototype.advance=function(s){return this.index_+=s,this},h.prototype.equals=function(s){return this.data_===s.data_&&this.index_===s.index_},h.prototype.swap=function(s){var r,o;r=u([s.data_,this.data_],2),this.data_=r[0],s.data_=r[1],o=u([s.index_,this.index_],2),this.index_=o[0],s.index_=o[1]},h}();return J.NativeArrayIterator=i,J}var ft;function xn(){if(ft)return G;ft=1;var u=G&&G.__extends||function(){var r=function(o,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])},r(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(o,e);function n(){this.constructor=o}o.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(G,"__esModule",{value:!0}),G.SetContainer=void 0;var i=Ge(),h=We(),s=function(r){u(o,r);function o(e){var n=r.call(this)||this;return n.data_=e(n),n}return o.prototype.assign=function(e,n){this.clear(),this.insert(e,n)},o.prototype.clear=function(){this.data_.clear()},o.prototype.begin=function(){return this.data_.begin()},o.prototype.end=function(){return this.data_.end()},o.prototype.has=function(e){return!this.find(e).equals(this.end())},o.prototype.size=function(){return this.data_.size()},o.prototype.push=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(e.length===0)return this.size();var t=new h.NativeArrayIterator(e,0),a=new h.NativeArrayIterator(e,e.length);return this._Insert_by_range(t,a),this.size()},o.prototype.insert=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.length===1?this._Insert_by_key(e[0]):e[0].next instanceof Function&&e[1].next instanceof Function?this._Insert_by_range(e[0],e[1]):this._Insert_by_hint(e[0],e[1])},o.prototype.erase=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.length===1&&!(e[0]instanceof this.end().constructor&&e[0].source()===this)?this._Erase_by_val(e[0]):e.length===1?this._Erase_by_range(e[0]):this._Erase_by_range(e[0],e[1])},o.prototype._Erase_by_range=function(e,n){n===void 0&&(n=e.next());var t=this.data_.erase(e,n);return this._Handle_erase(e,n),t},o}(i.Container);return G.SetContainer=s,G}var Ke={},Q={},V={},X={},ht;function wn(){if(ht)return X;ht=1;var u=X&&X.__extends||function(){var h=function(s,r){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,e){o.__proto__=e}||function(o,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n])},h(s,r)};return function(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");h(s,r);function o(){this.constructor=s}s.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(X,"__esModule",{value:!0}),X.Exception=void 0;var i=function(h){u(s,h);function s(r){var o=this.constructor,e=h.call(this,r)||this,n=o.prototype;return Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n,e}return Object.defineProperty(s.prototype,"name",{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),s.prototype.what=function(){return this.message},s.prototype.toJSON=function(){return{name:this.name,message:this.message,stack:this.stack}},s}(Error);return X.Exception=i,X}var pt;function ir(){if(pt)return V;pt=1;var u=V&&V.__extends||function(){var s=function(r,o){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},s(r,o)};return function(r,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");s(r,o);function e(){this.constructor=r}r.prototype=o===null?Object.create(o):(e.prototype=o.prototype,new e)}}();Object.defineProperty(V,"__esModule",{value:!0}),V.LogicError=void 0;var i=wn(),h=function(s){u(r,s);function r(o){return s.call(this,o)||this}return r}(i.Exception);return V.LogicError=h,V}var _t;function ar(){if(_t)return Q;_t=1;var u=Q&&Q.__extends||function(){var s=function(r,o){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},s(r,o)};return function(r,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");s(r,o);function e(){this.constructor=r}r.prototype=o===null?Object.create(o):(e.prototype=o.prototype,new e)}}();Object.defineProperty(Q,"__esModule",{value:!0}),Q.InvalidArgument=void 0;var i=ir(),h=function(s){u(r,s);function r(o){return s.call(this,o)||this}return r}(i.LogicError);return Q.InvalidArgument=h,Q}var Y={},vt;function jn(){if(vt)return Y;vt=1;var u=Y&&Y.__extends||function(){var s=function(r,o){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},s(r,o)};return function(r,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");s(r,o);function e(){this.constructor=r}r.prototype=o===null?Object.create(o):(e.prototype=o.prototype,new e)}}();Object.defineProperty(Y,"__esModule",{value:!0}),Y.OutOfRange=void 0;var i=ir(),h=function(s){u(r,s);function r(o){return s.call(this,o)||this}return r}(i.LogicError);return Y.OutOfRange=h,Y}var yt;function Le(){return yt||(yt=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.ErrorGenerator=void 0;var i=ar(),h=jn();(function(s){function r(d){if(typeof d=="string")return d;var _=d.constructor.name;return d.constructor.__MODULE&&(_="".concat(d.constructor.__MODULE,".").concat(_)),"std.".concat(_)}s.get_class_name=r;function o(d,_){return new h.OutOfRange("Error on ".concat(r(d),".").concat(_,"(): it's empty container."))}s.empty=o;function e(d,_,v){return new h.OutOfRange("Error on ".concat(r(d),".").concat(_,"(): parametric index is negative -> (index = ").concat(v,")."))}s.negative_index=e;function n(d,_,v,y){return new h.OutOfRange("Error on ".concat(r(d),".").concat(_,"(): parametric index is equal or greater than size -> (index = ").concat(v,", size: ").concat(y,")."))}s.excessive_index=n;function t(d,_){return new i.InvalidArgument("Error on ".concat(r(d),".").concat(_,"(): parametric iterator is not this container's own."))}s.not_my_iterator=t;function a(d,_){return new i.InvalidArgument("Error on ".concat(r(d),".").concat(_,"(): parametric iterator, it already has been erased."))}s.erased_iterator=a;function f(d,_,v){return new h.OutOfRange("Error on ".concat(r(d),".").concat(_,"(): parametric iterator is directing negative position -> (index = ").concat(v,")."))}s.negative_iterator=f;function c(d,_){_===void 0&&(_="end");var v=r(d);return new h.OutOfRange("Error on ".concat(v,".Iterator.value: cannot access to the ").concat(v,".").concat(_,"().value."))}s.iterator_end_value=c;function l(d,_,v){throw new h.OutOfRange("Error on ".concat(r(d),".").concat(_,"(): unable to find the matched key -> ").concat(v))}s.key_nout_found=l})(u.ErrorGenerator||(u.ErrorGenerator={}))}(Ke)),Ke}var gt;function kn(){if(gt)return M;gt=1;var u=M&&M.__extends||function(){var e=function(n,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,f){a.__proto__=f}||function(a,f){for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(a[c]=f[c])},e(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(n,t);function a(){this.constructor=n}n.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}(),i=M&&M.__read||function(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var a=t.call(e),f,c=[],l;try{for(;(n===void 0||n-- >0)&&!(f=a.next()).done;)c.push(f.value)}catch(d){l={error:d}}finally{try{f&&!f.done&&(t=a.return)&&t.call(a)}finally{if(l)throw l.error}}return c},h=M&&M.__spreadArray||function(e,n,t){if(t||arguments.length===2)for(var a=0,f=n.length,c;a<f;a++)(c||!(a in n))&&(c||(c=Array.prototype.slice.call(n,0,a)),c[a]=n[a]);return e.concat(c||Array.prototype.slice.call(n))};Object.defineProperty(M,"__esModule",{value:!0}),M.UniqueSet=void 0;var s=xn(),r=Le(),o=function(e){u(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.count=function(t){return this.find(t).equals(this.end())?0:1},n.prototype.insert=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return e.prototype.insert.apply(this,h([],i(t),!1))},n.prototype._Insert_by_range=function(t,a){for(;!t.equals(a);t=t.next())this._Insert_by_key(t.value)},n.prototype.extract=function(t){return t instanceof this.end().constructor?this._Extract_by_iterator(t):this._Extract_by_val(t)},n.prototype._Extract_by_val=function(t){var a=this.find(t);if(a.equals(this.end())===!0)throw r.ErrorGenerator.key_nout_found(this,"extract",t);return this._Erase_by_range(a),t},n.prototype._Extract_by_iterator=function(t){return t.equals(this.end())===!0||this.has(t.value)===!1?this.end():(this._Erase_by_range(t),t)},n.prototype._Erase_by_val=function(t){var a=this.find(t);return a.equals(this.end())===!0?0:(this._Erase_by_range(a),1)},n.prototype.merge=function(t){for(var a=t.begin();!a.equals(t.end());)this.has(a.value)===!1?(this.insert(a.value),a=t.erase(a)):a=a.next()},n}(s.SetContainer);return M.UniqueSet=o,M}var Z={},ee={},mt;function Sn(){return mt||(mt=1,function(u){var i=ee&&ee.__read||function(s,r){var o=typeof Symbol=="function"&&s[Symbol.iterator];if(!o)return s;var e=o.call(s),n,t=[],a;try{for(;(r===void 0||r-- >0)&&!(n=e.next()).done;)t.push(n.value)}catch(f){a={error:f}}finally{try{n&&!n.done&&(o=e.return)&&o.call(e)}finally{if(a)throw a.error}}return t},h=ee&&ee.__spreadArray||function(s,r,o){if(o||arguments.length===2)for(var e=0,n=r.length,t;e<n;e++)(t||!(e in r))&&(t||(t=Array.prototype.slice.call(r,0,e)),t[e]=r[e]);return s.concat(t||Array.prototype.slice.call(r))};Object.defineProperty(u,"__esModule",{value:!0}),u.IAssociativeContainer=void 0,function(s){function r(o){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var t,a;return e.length>=1&&e[0]instanceof Array?(t=function(){var f=e[0];o.push.apply(o,h([],i(f),!1))},a=e.slice(1)):e.length>=2&&e[0].next instanceof Function&&e[1].next instanceof Function?(t=function(){var f=e[0],c=e[1];o.assign(f,c)},a=e.slice(2)):(t=null,a=e),{ramda:t,tail:a}}s.construct=r}(u.IAssociativeContainer||(u.IAssociativeContainer={}))}(ee)),ee}var te={},ye={},ge={},bt;function Cn(){if(bt)return ge;bt=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge._Get_root=void 0;var u=sr();function i(){return h===null&&(h=(0,u.is_node)()?Pe:self,h.__s_iUID===void 0&&(h.__s_iUID=0)),h}ge._Get_root=i;var h=null;return ge}var xt;function cr(){if(xt)return ye;xt=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.get_uid=void 0;var u=Cn();function i(h){if(h instanceof Object){if(h.hasOwnProperty("__get_m_iUID")===!1){var s=++(0,u._Get_root)().__s_iUID;Object.defineProperty(h,"__get_m_iUID",{value:function(){return s}})}return h.__get_m_iUID()}else return h===void 0?-1:0}return ye.get_uid=i,ye}var wt;function Je(){if(wt)return te;wt=1;var u=te&&te.__values||function(t){var a=typeof Symbol=="function"&&Symbol.iterator,f=a&&t[a],c=0;if(f)return f.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&c>=t.length&&(t=void 0),{value:t&&t[c++],done:!t}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(te,"__esModule",{value:!0}),te.hash=void 0;var i=cr();function h(){for(var t,a,f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];var l=e;try{for(var d=u(f),_=d.next();!_.done;_=d.next()){var v=_.value;v=v&&v.valueOf();var y=typeof v;if(y==="boolean")l=s(v,l);else if(y==="number"||y==="bigint")l=r(v,l);else if(y==="string")l=o(v,l);else if(v instanceof Object&&v.hashCode instanceof Function){var b=v.hashCode();if(f.length===1)return b;l=l^b,l*=n}else l=r((0,i.get_uid)(v),l)}}catch(m){t={error:m}}finally{try{_&&!_.done&&(a=d.return)&&a.call(d)}finally{if(t)throw t.error}}return Math.abs(l)}te.hash=h;function s(t,a){return a^=t?1:0,a*=n,a}function r(t,a){return o(t.toString(),a)}function o(t,a){for(var f=0;f<t.length;++f)a^=t.charCodeAt(f),a*=n;return Math.abs(a)}var e=2166136261,n=16777619;return te}var N={},jt;function Qe(){if(jt)return N;jt=1,Object.defineProperty(N,"__esModule",{value:!0}),N.greater_equal=N.greater=N.less_equal=N.less=N.not_equal_to=N.equal_to=void 0;var u=cr();function i(n,t){return n=n&&n.valueOf(),t=t&&t.valueOf(),n instanceof Object&&n.equals instanceof Function?n.equals(t):n===t}N.equal_to=i;function h(n,t){return!i(n,t)}N.not_equal_to=h;function s(n,t){return n=n.valueOf(),t=t.valueOf(),n instanceof Object?n.less instanceof Function?n.less(t):(0,u.get_uid)(n)<(0,u.get_uid)(t):n<t}N.less=s;function r(n,t){return s(n,t)||i(n,t)}N.less_equal=r;function o(n,t){return!r(n,t)}N.greater=o;function e(n,t){return!s(n,t)}return N.greater_equal=e,N}var kt;function lr(){return kt||(kt=1,function(u){var i=Z&&Z.__read||function(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var a=t.call(e),f,c=[],l;try{for(;(n===void 0||n-- >0)&&!(f=a.next()).done;)c.push(f.value)}catch(d){l={error:d}}finally{try{f&&!f.done&&(t=a.return)&&t.call(a)}finally{if(l)throw l.error}}return c},h=Z&&Z.__spreadArray||function(e,n,t){if(t||arguments.length===2)for(var a=0,f=n.length,c;a<f;a++)(c||!(a in n))&&(c||(c=Array.prototype.slice.call(n,0,a)),c[a]=n[a]);return e.concat(c||Array.prototype.slice.call(n))};Object.defineProperty(u,"__esModule",{value:!0}),u.IHashContainer=void 0;var s=Sn(),r=Je(),o=Qe();(function(e){function n(t,a,f){for(var c=[],l=3;l<arguments.length;l++)c[l-3]=arguments[l];var d=null,_=r.hash,v=o.equal_to;if(c.length===1&&c[0]instanceof a){var y=c[0];_=y.hash_function(),v=y.key_eq(),d=function(){var m=y.begin(),j=y.end();t.assign(m,j)}}else{var b=s.IAssociativeContainer.construct.apply(s.IAssociativeContainer,h([t],i(c),!1));d=b.ramda,b.tail.length>=1&&(_=b.tail[0]),b.tail.length>=2&&(v=b.tail[1])}f(_,v),d!==null&&d()}e.construct=n})(u.IHashContainer||(u.IHashContainer={}))}(Z)),Z}var re={},A={},me={},St;function Ve(){if(St)return me;St=1,Object.defineProperty(me,"__esModule",{value:!0}),me.ListIterator=void 0;var u=Le(),i=function(){function h(s,r,o){this.prev_=s,this.next_=r,this.value_=o}return h._Set_prev=function(s,r){s.prev_=r},h._Set_next=function(s,r){s.next_=r},h.prototype.prev=function(){return this.prev_},h.prototype.next=function(){return this.next_},Object.defineProperty(h.prototype,"value",{get:function(){return this._Try_value(),this.value_},enumerable:!1,configurable:!0}),h.prototype._Try_value=function(){if(this.value_===void 0&&this.equals(this.source().end())===!0)throw u.ErrorGenerator.iterator_end_value(this.source())},h.prototype.equals=function(s){return this===s},h}();return me.ListIterator=i,me}var be={},Ct;function Nn(){if(Ct)return be;Ct=1,Object.defineProperty(be,"__esModule",{value:!0}),be.Repeater=void 0;var u=function(){function i(h,s){this.index_=h,this.value_=s}return i.prototype.index=function(){return this.index_},Object.defineProperty(i.prototype,"value",{get:function(){return this.value_},enumerable:!1,configurable:!0}),i.prototype.next=function(){return++this.index_,this},i.prototype.equals=function(h){return this.index_===h.index_},i}();return be.Repeater=u,be}var E={},Nt;function En(){if(Nt)return E;Nt=1,Object.defineProperty(E,"__esModule",{value:!0}),E.next=E.prev=E.advance=E.distance=E.size=E.empty=void 0;var u=ar();function i(t){return t instanceof Array?t.length!==0:t.empty()}E.empty=i;function h(t){return t instanceof Array?t.length:t.size()}E.size=h;function s(t,a){if(t.index instanceof Function)return r(t,a);for(var f=0;!t.equals(a);t=t.next())++f;return f}E.distance=s;function r(t,a){var f=t.index(),c=a.index();return t.base instanceof Function?f-c:c-f}function o(t,a){if(a===0)return t;if(t.advance instanceof Function)return t.advance(a);var f;if(a<0){if(!(t.prev instanceof Function))throw new u.InvalidArgument("Error on std.advance(): parametric iterator is not a bi-directional iterator, thus advancing to negative direction is not possible.");f=function(c){return c.prev()},a=-a}else f=function(c){return c.next()};for(;a-- >0;)t=f(t);return t}E.advance=o;function e(t,a){return a===void 0&&(a=1),a===1?t.prev():o(t,-a)}E.prev=e;function n(t,a){return a===void 0&&(a=1),a===1?t.next():o(t,a)}return E.next=n,E}var Et;function ur(){if(Et)return A;Et=1;var u=A&&A.__extends||function(){var a=function(f,c){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var _ in d)Object.prototype.hasOwnProperty.call(d,_)&&(l[_]=d[_])},a(f,c)};return function(f,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(f,c);function l(){this.constructor=f}f.prototype=c===null?Object.create(c):(l.prototype=c.prototype,new l)}}(),i=A&&A.__read||function(a,f){var c=typeof Symbol=="function"&&a[Symbol.iterator];if(!c)return a;var l=c.call(a),d,_=[],v;try{for(;(f===void 0||f-- >0)&&!(d=l.next()).done;)_.push(d.value)}catch(y){v={error:y}}finally{try{d&&!d.done&&(c=l.return)&&c.call(l)}finally{if(v)throw v.error}}return _};Object.defineProperty(A,"__esModule",{value:!0}),A.ListContainer=void 0;var h=Ge(),s=Ve(),r=Nn(),o=We(),e=En(),n=Le(),t=function(a){u(f,a);function f(){var c=a.call(this)||this;return c.end_=c._Create_iterator(null,null),c.clear(),c}return f.prototype.assign=function(c,l){this.clear(),this.insert(this.end(),c,l)},f.prototype.clear=function(){s.ListIterator._Set_prev(this.end_,this.end_),s.ListIterator._Set_next(this.end_,this.end_),this.begin_=this.end_,this.size_=0},f.prototype.resize=function(c){var l=c-this.size();l>0?this.insert(this.end(),l,void 0):l<0&&this.erase((0,e.advance)(this.end(),-l),this.end())},f.prototype.begin=function(){return this.begin_},f.prototype.end=function(){return this.end_},f.prototype.size=function(){return this.size_},f.prototype.push_front=function(c){this.insert(this.begin_,c)},f.prototype.push_back=function(c){this.insert(this.end_,c)},f.prototype.pop_front=function(){if(this.empty()===!0)throw n.ErrorGenerator.empty(this.end_.source().constructor.name,"pop_front");this.erase(this.begin_)},f.prototype.pop_back=function(){if(this.empty()===!0)throw n.ErrorGenerator.empty(this.end_.source().constructor.name,"pop_back");this.erase(this.end_.prev())},f.prototype.push=function(){for(var c=[],l=0;l<arguments.length;l++)c[l]=arguments[l];if(c.length===0)return this.size();var d=new o.NativeArrayIterator(c,0),_=new o.NativeArrayIterator(c,c.length);return this._Insert_by_range(this.end(),d,_),this.size()},f.prototype.insert=function(c){for(var l=[],d=1;d<arguments.length;d++)l[d-1]=arguments[d];if(c.source()!==this.end_.source())throw n.ErrorGenerator.not_my_iterator(this.end_.source(),"insert");if(c.erased_===!0)throw n.ErrorGenerator.erased_iterator(this.end_.source(),"insert");return l.length===1?this._Insert_by_repeating_val(c,1,l[0]):l.length===2&&typeof l[0]=="number"?this._Insert_by_repeating_val(c,l[0],l[1]):this._Insert_by_range(c,l[0],l[1])},f.prototype._Insert_by_repeating_val=function(c,l,d){var _=new r.Repeater(0,d),v=new r.Repeater(l);return this._Insert_by_range(c,_,v)},f.prototype._Insert_by_range=function(c,l,d){for(var _=c.prev(),v=null,y=0,b=l;b.equals(d)===!1;b=b.next()){var m=this._Create_iterator(_,null,b.value);y===0&&(v=m),s.ListIterator._Set_next(_,m),_=m,++y}return c.equals(this.begin())===!0&&(this.begin_=v),s.ListIterator._Set_next(_,c),s.ListIterator._Set_prev(c,_),this.size_+=y,v},f.prototype.erase=function(c,l){return l===void 0&&(l=c.next()),this._Erase_by_range(c,l)},f.prototype._Erase_by_range=function(c,l){if(c.source()!==this.end_.source())throw n.ErrorGenerator.not_my_iterator(this.end_.source(),"insert");if(c.erased_===!0)throw n.ErrorGenerator.erased_iterator(this.end_.source(),"insert");if(c.equals(this.end_))return this.end_;var d=c.prev();s.ListIterator._Set_next(d,l),s.ListIterator._Set_prev(l,d);for(var _=c;!_.equals(l);_=_.next())_.erased_=!0,--this.size_;return c.equals(this.begin_)&&(this.begin_=l),l},f.prototype.swap=function(c){var l,d,_;l=i([c.begin_,this.begin_],2),this.begin_=l[0],c.begin_=l[1],d=i([c.end_,this.end_],2),this.end_=d[0],c.end_=d[1],_=i([c.size_,this.size_],2),this.size_=_[0],c.size_=_[1]},f}(h.Container);return A.ListContainer=t,A}var xe={},Ot;function dr(){if(Ot)return xe;Ot=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.ReverseIterator=void 0;var u=function(){function i(h){this.base_=h.prev()}return i.prototype.source=function(){return this.base_.source()},i.prototype.base=function(){return this.base_.next()},Object.defineProperty(i.prototype,"value",{get:function(){return this.base_.value},enumerable:!1,configurable:!0}),i.prototype.prev=function(){return this._Create_neighbor(this.base().next())},i.prototype.next=function(){return this._Create_neighbor(this.base_)},i.prototype.equals=function(h){return this.base_.equals(h.base_)},i}();return xe.ReverseIterator=u,xe}var Pt;function On(){return Pt||(Pt=1,function(u){var i=re&&re.__extends||function(){var n=function(t,a){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,c){f.__proto__=c}||function(f,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(f[l]=c[l])},n(t,a)};return function(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");n(t,a);function f(){this.constructor=t}t.prototype=a===null?Object.create(a):(f.prototype=a.prototype,new f)}}(),h=re&&re.__read||function(n,t){var a=typeof Symbol=="function"&&n[Symbol.iterator];if(!a)return n;var f=a.call(n),c,l=[],d;try{for(;(t===void 0||t-- >0)&&!(c=f.next()).done;)l.push(c.value)}catch(_){d={error:_}}finally{try{c&&!c.done&&(a=f.return)&&a.call(f)}finally{if(d)throw d.error}}return l};Object.defineProperty(u,"__esModule",{value:!0}),u.SetElementList=void 0;var s=ur(),r=Ve(),o=dr(),e=function(n){i(t,n);function t(a){var f=n.call(this)||this;return f.associative_=a,f}return t.prototype._Create_iterator=function(a,f,c){return t.Iterator.create(this,a,f,c)},t._Swap_associative=function(a,f){var c;c=h([f.associative_,a.associative_],2),a.associative_=c[0],f.associative_=c[1]},t.prototype.associative=function(){return this.associative_},t}(s.ListContainer);u.SetElementList=e,function(n){var t=function(f){i(c,f);function c(l,d,_,v){var y=f.call(this,d,_,v)||this;return y.source_=l,y}return c.create=function(l,d,_,v){return new c(l,d,_,v)},c.prototype.reverse=function(){return new a(this)},c.prototype.source=function(){return this.source_.associative()},c}(r.ListIterator);n.Iterator=t;var a=function(f){i(c,f);function c(){return f!==null&&f.apply(this,arguments)||this}return c.prototype._Create_neighbor=function(l){return new c(l)},c}(o.ReverseIterator);n.ReverseIterator=a}(e=u.SetElementList||(u.SetElementList={})),u.SetElementList=e}(re)),re}var L={},ne={},It;function fr(){if(It)return ne;It=1;var u=ne&&ne.__values||function(r){var o=typeof Symbol=="function"&&Symbol.iterator,e=o&&r[o],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ne,"__esModule",{value:!0}),ne.HashBuckets=void 0;var i=function(){function r(o,e){this.fetcher_=o,this.hasher_=e,this.max_load_factor_=s,this.data_=[],this.size_=0,this.initialize()}return r.prototype.clear=function(){this.data_=[],this.size_=0,this.initialize()},r.prototype.rehash=function(o){var e,n,t,a;o=Math.max(o,h);for(var f=[],c=0;c<o;++c)f.push([]);try{for(var l=u(this.data_),d=l.next();!d.done;d=l.next()){var _=d.value;try{for(var v=(t=void 0,u(_)),y=v.next();!y.done;y=v.next()){var b=y.value,m=this.hasher_(this.fetcher_(b))%f.length;f[m].push(b)}}catch(j){t={error:j}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(t)throw t.error}}}}catch(j){e={error:j}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}this.data_=f},r.prototype.reserve=function(o){o>this.capacity()&&(o=Math.floor(o/this.max_load_factor_),this.rehash(o))},r.prototype.initialize=function(){for(var o=0;o<h;++o)this.data_.push([])},r.prototype.length=function(){return this.data_.length},r.prototype.capacity=function(){return this.data_.length*this.max_load_factor_},r.prototype.at=function(o){return this.data_[o]},r.prototype.load_factor=function(){return this.size_/this.length()},r.prototype.max_load_factor=function(o){if(o===void 0&&(o=null),o===null)return this.max_load_factor_;this.max_load_factor_=o},r.prototype.hash_function=function(){return this.hasher_},r.prototype.index=function(o){return this.hasher_(this.fetcher_(o))%this.length()},r.prototype.insert=function(o){var e=this.capacity();++this.size_>e&&this.reserve(e*2);var n=this.index(o);this.data_[n].push(o)},r.prototype.erase=function(o){for(var e=this.index(o),n=this.data_[e],t=0;t<n.length;++t)if(n[t]===o){n.splice(t,1),--this.size_;break}},r}();ne.HashBuckets=i;var h=10,s=1;return ne}var Rt;function Pn(){if(Rt)return L;Rt=1;var u=L&&L.__extends||function(){var e=function(n,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,f){a.__proto__=f}||function(a,f){for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(a[c]=f[c])},e(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(n,t);function a(){this.constructor=n}n.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}(),i=L&&L.__read||function(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var a=t.call(e),f,c=[],l;try{for(;(n===void 0||n-- >0)&&!(f=a.next()).done;)c.push(f.value)}catch(d){l={error:d}}finally{try{f&&!f.done&&(t=a.return)&&t.call(a)}finally{if(l)throw l.error}}return c},h=L&&L.__values||function(e){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&e[n],a=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(L,"__esModule",{value:!0}),L.SetHashBuckets=void 0;var s=fr(),r=function(e){u(n,e);function n(t,a,f){var c=e.call(this,o,a)||this;return c.source_=t,c.key_eq_=f,c}return n._Swap_source=function(t,a){var f;f=i([a.source_,t.source_],2),t.source_=f[0],a.source_=f[1]},n.prototype.key_eq=function(){return this.key_eq_},n.prototype.find=function(t){var a,f,c=this.hash_function()(t)%this.length(),l=this.at(c);try{for(var d=h(l),_=d.next();!_.done;_=d.next()){var v=_.value;if(this.key_eq_(v.value,t))return v}}catch(y){a={error:y}}finally{try{_&&!_.done&&(f=d.return)&&f.call(d)}finally{if(a)throw a.error}}return this.source_.end()},n}(s.HashBuckets);L.SetHashBuckets=r;function o(e){return e.value}return L}var oe={},Mt;function hr(){if(Mt)return oe;Mt=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.make_pair=oe.Pair=void 0;var u=Je(),i=Qe(),h=function(){function r(o,e){this.first=o,this.second=e}return r.prototype.equals=function(o){return(0,i.equal_to)(this.first,o.first)&&(0,i.equal_to)(this.second,o.second)},r.prototype.less=function(o){return(0,i.equal_to)(this.first,o.first)===!1?(0,i.less)(this.first,o.first):(0,i.less)(this.second,o.second)},r.prototype.hashCode=function(){return(0,u.hash)(this.first,this.second)},r}();oe.Pair=h;function s(r,o){return new h(r,o)}return oe.make_pair=s,oe}var Lt;function In(){return Lt||(Lt=1,function(u){var i=F&&F.__extends||function(){var f=function(c,l){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,_){d.__proto__=_}||function(d,_){for(var v in _)Object.prototype.hasOwnProperty.call(_,v)&&(d[v]=_[v])},f(c,l)};return function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");f(c,l);function d(){this.constructor=c}c.prototype=l===null?Object.create(l):(d.prototype=l.prototype,new d)}}(),h=F&&F.__read||function(f,c){var l=typeof Symbol=="function"&&f[Symbol.iterator];if(!l)return f;var d=l.call(f),_,v=[],y;try{for(;(c===void 0||c-- >0)&&!(_=d.next()).done;)v.push(_.value)}catch(b){y={error:b}}finally{try{_&&!_.done&&(l=d.return)&&l.call(d)}finally{if(y)throw y.error}}return v},s=F&&F.__spreadArray||function(f,c,l){if(l||arguments.length===2)for(var d=0,_=c.length,v;d<_;d++)(v||!(d in c))&&(v||(v=Array.prototype.slice.call(c,0,d)),v[d]=c[d]);return f.concat(v||Array.prototype.slice.call(c))};Object.defineProperty(u,"__esModule",{value:!0}),u.HashSet=void 0;var r=kn(),o=lr(),e=On(),n=Pn(),t=hr(),a=function(f){i(c,f);function c(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];var _=f.call(this,function(v){return new e.SetElementList(v)})||this;return o.IHashContainer.construct.apply(o.IHashContainer,s([_,c,function(v,y){_.buckets_=new n.SetHashBuckets(_,v,y)}],h(l),!1)),_}return c.prototype.clear=function(){this.buckets_.clear(),f.prototype.clear.call(this)},c.prototype.swap=function(l){var d,_;d=h([l.data_,this.data_],2),this.data_=d[0],l.data_=d[1],e.SetElementList._Swap_associative(this.data_,l.data_),n.SetHashBuckets._Swap_source(this.buckets_,l.buckets_),_=h([l.buckets_,this.buckets_],2),this.buckets_=_[0],l.buckets_=_[1]},c.prototype.find=function(l){return this.buckets_.find(l)},c.prototype.begin=function(l){return l===void 0&&(l=null),l===null?f.prototype.begin.call(this):this.buckets_.at(l)[0]},c.prototype.end=function(l){if(l===void 0&&(l=null),l===null)return f.prototype.end.call(this);var d=this.buckets_.at(l);return d[d.length-1].next()},c.prototype.rbegin=function(l){return l===void 0&&(l=null),this.end(l).reverse()},c.prototype.rend=function(l){return l===void 0&&(l=null),this.begin(l).reverse()},c.prototype.bucket_count=function(){return this.buckets_.length()},c.prototype.bucket_size=function(l){return this.buckets_.at(l).length},c.prototype.load_factor=function(){return this.buckets_.load_factor()},c.prototype.hash_function=function(){return this.buckets_.hash_function()},c.prototype.key_eq=function(){return this.buckets_.key_eq()},c.prototype.bucket=function(l){return this.hash_function()(l)%this.buckets_.length()},c.prototype.max_load_factor=function(l){return l===void 0&&(l=null),this.buckets_.max_load_factor(l)},c.prototype.reserve=function(l){this.buckets_.reserve(l)},c.prototype.rehash=function(l){this.buckets_.rehash(l)},c.prototype._Insert_by_key=function(l){var d=this.find(l);return d.equals(this.end())===!1?new t.Pair(d,!1):(this.data_.push(l),d=d.prev(),this._Handle_insert(d,d.next()),new t.Pair(d,!0))},c.prototype._Insert_by_hint=function(l,d){var _=this.find(d);return _.equals(this.end())===!0&&(_=this.data_.insert(l,d),this._Handle_insert(_,_.next())),_},c.prototype._Handle_insert=function(l,d){for(;!l.equals(d);l=l.next())this.buckets_.insert(l)},c.prototype._Handle_erase=function(l,d){for(;!l.equals(d);l=l.next())this.buckets_.erase(l)},c}(r.UniqueSet);u.HashSet=a,function(f){f.Iterator=e.SetElementList.Iterator,f.ReverseIterator=e.SetElementList.ReverseIterator}(a=u.HashSet||(u.HashSet={})),u.HashSet=a}(F)),F}var T={},z={},se={},zt;function Rn(){if(zt)return se;zt=1;var u=se&&se.__extends||function(){var r=function(o,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])},r(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(o,e);function n(){this.constructor=o}o.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(se,"__esModule",{value:!0}),se.MapContainer=void 0;var i=Ge(),h=We(),s=function(r){u(o,r);function o(e){var n=r.call(this)||this;return n.data_=e(n),n}return o.prototype.assign=function(e,n){this.clear(),this.insert(e,n)},o.prototype.clear=function(){this.data_.clear()},o.prototype.begin=function(){return this.data_.begin()},o.prototype.end=function(){return this.data_.end()},o.prototype.has=function(e){return!this.find(e).equals(this.end())},o.prototype.size=function(){return this.data_.size()},o.prototype.push=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=new h.NativeArrayIterator(e,0),a=new h.NativeArrayIterator(e,e.length);return this.insert(t,a),this.size()},o.prototype.insert=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.length===1?this.emplace(e[0].first,e[0].second):e[0].next instanceof Function&&e[1].next instanceof Function?this._Insert_by_range(e[0],e[1]):this.emplace_hint(e[0],e[1].first,e[1].second)},o.prototype.erase=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.length===1&&(!(e[0]instanceof this.end().constructor)||e[0].source()!==this)?this._Erase_by_key(e[0]):e.length===1?this._Erase_by_range(e[0]):this._Erase_by_range(e[0],e[1])},o.prototype._Erase_by_range=function(e,n){n===void 0&&(n=e.next());var t=this.data_.erase(e,n);return this._Handle_erase(e,n),t},o}(i.Container);return se.MapContainer=s,se}var qt;function Mn(){if(qt)return z;qt=1;var u=z&&z.__extends||function(){var e=function(n,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,f){a.__proto__=f}||function(a,f){for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(a[c]=f[c])},e(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(n,t);function a(){this.constructor=n}n.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}(),i=z&&z.__read||function(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var a=t.call(e),f,c=[],l;try{for(;(n===void 0||n-- >0)&&!(f=a.next()).done;)c.push(f.value)}catch(d){l={error:d}}finally{try{f&&!f.done&&(t=a.return)&&t.call(a)}finally{if(l)throw l.error}}return c},h=z&&z.__spreadArray||function(e,n,t){if(t||arguments.length===2)for(var a=0,f=n.length,c;a<f;a++)(c||!(a in n))&&(c||(c=Array.prototype.slice.call(n,0,a)),c[a]=n[a]);return e.concat(c||Array.prototype.slice.call(n))};Object.defineProperty(z,"__esModule",{value:!0}),z.UniqueMap=void 0;var s=Rn(),r=Le(),o=function(e){u(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.count=function(t){return this.find(t).equals(this.end())?0:1},n.prototype.get=function(t){var a=this.find(t);if(a.equals(this.end())===!0)throw r.ErrorGenerator.key_nout_found(this,"get",t);return a.second},n.prototype.take=function(t,a){var f=this.find(t);return f.equals(this.end())?this.emplace(t,a()).first.second:f.second},n.prototype.set=function(t,a){this.insert_or_assign(t,a)},n.prototype.insert=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return e.prototype.insert.apply(this,h([],i(t),!1))},n.prototype._Insert_by_range=function(t,a){for(var f=t;!f.equals(a);f=f.next())this.emplace(f.value.first,f.value.second)},n.prototype.insert_or_assign=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];if(t.length===2)return this._Insert_or_assign_with_key_value(t[0],t[1]);if(t.length===3)return this._Insert_or_assign_with_hint(t[0],t[1],t[2])},n.prototype._Insert_or_assign_with_key_value=function(t,a){var f=this.emplace(t,a);return f.second===!1&&(f.first.second=a),f},n.prototype._Insert_or_assign_with_hint=function(t,a,f){var c=this.emplace_hint(t,a,f);return c.second!==f&&(c.second=f),c},n.prototype.extract=function(t){return t instanceof this.end().constructor?this._Extract_by_iterator(t):this._Extract_by_key(t)},n.prototype._Extract_by_key=function(t){var a=this.find(t);if(a.equals(this.end())===!0)throw r.ErrorGenerator.key_nout_found(this,"extract",t);var f=a.value;return this._Erase_by_range(a),f},n.prototype._Extract_by_iterator=function(t){return t.equals(this.end())===!0?this.end():(this._Erase_by_range(t),t)},n.prototype._Erase_by_key=function(t){var a=this.find(t);return a.equals(this.end())===!0?0:(this._Erase_by_range(a),1)},n.prototype.merge=function(t){for(var a=t.begin();!a.equals(t.end());)this.has(a.first)===!1?(this.insert(a.value),a=t.erase(a)):a=a.next()},n}(s.MapContainer);return z.UniqueMap=o,z}var ie={},Ft;function Ln(){return Ft||(Ft=1,function(u){var i=ie&&ie.__extends||function(){var n=function(t,a){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,c){f.__proto__=c}||function(f,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(f[l]=c[l])},n(t,a)};return function(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");n(t,a);function f(){this.constructor=t}t.prototype=a===null?Object.create(a):(f.prototype=a.prototype,new f)}}(),h=ie&&ie.__read||function(n,t){var a=typeof Symbol=="function"&&n[Symbol.iterator];if(!a)return n;var f=a.call(n),c,l=[],d;try{for(;(t===void 0||t-- >0)&&!(c=f.next()).done;)l.push(c.value)}catch(_){d={error:_}}finally{try{c&&!c.done&&(a=f.return)&&a.call(f)}finally{if(d)throw d.error}}return l};Object.defineProperty(u,"__esModule",{value:!0}),u.MapElementList=void 0;var s=ur(),r=Ve(),o=dr(),e=function(n){i(t,n);function t(a){var f=n.call(this)||this;return f.associative_=a,f}return t.prototype._Create_iterator=function(a,f,c){return t.Iterator.create(this,a,f,c)},t._Swap_associative=function(a,f){var c;c=h([f.associative_,a.associative_],2),a.associative_=c[0],f.associative_=c[1]},t.prototype.associative=function(){return this.associative_},t}(s.ListContainer);u.MapElementList=e,function(n){var t=function(f){i(c,f);function c(l,d,_,v){var y=f.call(this,d,_,v)||this;return y.list_=l,y}return c.create=function(l,d,_,v){return new c(l,d,_,v)},c.prototype.reverse=function(){return new a(this)},c.prototype.source=function(){return this.list_.associative()},Object.defineProperty(c.prototype,"first",{get:function(){return this.value.first},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"second",{get:function(){return this.value.second},set:function(l){this.value.second=l},enumerable:!1,configurable:!0}),c}(r.ListIterator);n.Iterator=t;var a=function(f){i(c,f);function c(){return f!==null&&f.apply(this,arguments)||this}return c.prototype._Create_neighbor=function(l){return new c(l)},Object.defineProperty(c.prototype,"first",{get:function(){return this.base_.first},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"second",{get:function(){return this.base_.second},set:function(l){this.base_.second=l},enumerable:!1,configurable:!0}),c}(o.ReverseIterator);n.ReverseIterator=a}(e=u.MapElementList||(u.MapElementList={})),u.MapElementList=e}(ie)),ie}var q={},At;function zn(){if(At)return q;At=1;var u=q&&q.__extends||function(){var e=function(n,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,f){a.__proto__=f}||function(a,f){for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(a[c]=f[c])},e(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(n,t);function a(){this.constructor=n}n.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}(),i=q&&q.__read||function(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var a=t.call(e),f,c=[],l;try{for(;(n===void 0||n-- >0)&&!(f=a.next()).done;)c.push(f.value)}catch(d){l={error:d}}finally{try{f&&!f.done&&(t=a.return)&&t.call(a)}finally{if(l)throw l.error}}return c},h=q&&q.__values||function(e){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&e[n],a=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(q,"__esModule",{value:!0}),q.MapHashBuckets=void 0;var s=fr(),r=function(e){u(n,e);function n(t,a,f){var c=e.call(this,o,a)||this;return c.source_=t,c.key_eq_=f,c}return n._Swap_source=function(t,a){var f;f=i([a.source_,t.source_],2),t.source_=f[0],a.source_=f[1]},n.prototype.key_eq=function(){return this.key_eq_},n.prototype.find=function(t){var a,f,c=this.hash_function()(t)%this.length(),l=this.at(c);try{for(var d=h(l),_=d.next();!_.done;_=d.next()){var v=_.value;if(this.key_eq_(v.first,t))return v}}catch(y){a={error:y}}finally{try{_&&!_.done&&(f=d.return)&&f.call(d)}finally{if(a)throw a.error}}return this.source_.end()},n}(s.HashBuckets);q.MapHashBuckets=r;function o(e){return e.first}return q}var we={},Tt;function qn(){if(Tt)return we;Tt=1,Object.defineProperty(we,"__esModule",{value:!0}),we.Entry=void 0;var u=Je(),i=Qe(),h=function(){function s(r,o){this.first=r,this.second=o}return s.prototype.equals=function(r){return(0,i.equal_to)(this.first,r.first)},s.prototype.less=function(r){return(0,i.less)(this.first,r.first)},s.prototype.hashCode=function(){return(0,u.hash)(this.first)},s}();return we.Entry=h,we}var $t;function Fn(){return $t||($t=1,function(u){var i=T&&T.__extends||function(){var c=function(l,d){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,v){_.__proto__=v}||function(_,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(_[y]=v[y])},c(l,d)};return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");c(l,d);function _(){this.constructor=l}l.prototype=d===null?Object.create(d):(_.prototype=d.prototype,new _)}}(),h=T&&T.__read||function(c,l){var d=typeof Symbol=="function"&&c[Symbol.iterator];if(!d)return c;var _=d.call(c),v,y=[],b;try{for(;(l===void 0||l-- >0)&&!(v=_.next()).done;)y.push(v.value)}catch(m){b={error:m}}finally{try{v&&!v.done&&(d=_.return)&&d.call(_)}finally{if(b)throw b.error}}return y},s=T&&T.__spreadArray||function(c,l,d){if(d||arguments.length===2)for(var _=0,v=l.length,y;_<v;_++)(y||!(_ in l))&&(y||(y=Array.prototype.slice.call(l,0,_)),y[_]=l[_]);return c.concat(y||Array.prototype.slice.call(l))};Object.defineProperty(u,"__esModule",{value:!0}),u.HashMap=void 0;var r=Mn(),o=lr(),e=Ln(),n=zn(),t=qn(),a=hr(),f=function(c){i(l,c);function l(){for(var d=[],_=0;_<arguments.length;_++)d[_]=arguments[_];var v=c.call(this,function(y){return new e.MapElementList(y)})||this;return o.IHashContainer.construct.apply(o.IHashContainer,s([v,l,function(y,b){v.buckets_=new n.MapHashBuckets(v,y,b)}],h(d),!1)),v}return l.prototype.clear=function(){this.buckets_.clear(),c.prototype.clear.call(this)},l.prototype.swap=function(d){var _,v;_=h([d.data_,this.data_],2),this.data_=_[0],d.data_=_[1],e.MapElementList._Swap_associative(this.data_,d.data_),n.MapHashBuckets._Swap_source(this.buckets_,d.buckets_),v=h([d.buckets_,this.buckets_],2),this.buckets_=v[0],d.buckets_=v[1]},l.prototype.find=function(d){return this.buckets_.find(d)},l.prototype.begin=function(d){return d===void 0&&(d=null),d===null?c.prototype.begin.call(this):this.buckets_.at(d)[0]},l.prototype.end=function(d){if(d===void 0&&(d=null),d===null)return c.prototype.end.call(this);var _=this.buckets_.at(d);return _[_.length-1].next()},l.prototype.rbegin=function(d){return d===void 0&&(d=null),this.end(d).reverse()},l.prototype.rend=function(d){return d===void 0&&(d=null),this.begin(d).reverse()},l.prototype.bucket_count=function(){return this.buckets_.length()},l.prototype.bucket_size=function(d){return this.buckets_.at(d).length},l.prototype.load_factor=function(){return this.buckets_.load_factor()},l.prototype.hash_function=function(){return this.buckets_.hash_function()},l.prototype.key_eq=function(){return this.buckets_.key_eq()},l.prototype.bucket=function(d){return this.hash_function()(d)%this.buckets_.length()},l.prototype.max_load_factor=function(d){return d===void 0&&(d=null),this.buckets_.max_load_factor(d)},l.prototype.reserve=function(d){this.buckets_.reserve(d)},l.prototype.rehash=function(d){this.buckets_.rehash(d)},l.prototype.emplace=function(d,_){var v=this.find(d);return v.equals(this.end())===!1?new a.Pair(v,!1):(this.data_.push(new t.Entry(d,_)),v=v.prev(),this._Handle_insert(v,v.next()),new a.Pair(v,!0))},l.prototype.emplace_hint=function(d,_,v){var y=this.find(_);return y.equals(this.end())===!0&&(y=this.data_.insert(d,new t.Entry(_,v)),this._Handle_insert(y,y.next())),y},l.prototype._Handle_insert=function(d,_){for(;!d.equals(_);d=d.next())this.buckets_.insert(d)},l.prototype._Handle_erase=function(d,_){for(;!d.equals(_);d=d.next())this.buckets_.erase(d)},l}(r.UniqueMap);u.HashMap=f,function(c){c.Iterator=e.MapElementList.Iterator,c.ReverseIterator=e.MapElementList.ReverseIterator}(f=u.HashMap||(u.HashMap={})),u.HashMap=f}(T)),T}var Ht;function An(){if(Ht)return ae;Ht=1;var u=ae&&ae.__values||function(r){var o=typeof Symbol=="function"&&r[Symbol.iterator],e=0;return o?o.call(r):{next:function(){return r&&e>=r.length&&(r=void 0),{value:r&&r[e++],done:!r}}}};Object.defineProperty(ae,"__esModule",{value:!0});var i=In(),h=Fn(),s=function(){function r(){this.listeners_=new h.HashMap,this.created_at_=new Date}return r.prototype.dispatchEvent=function(o){var e,n,t=this.listeners_.find(o.type);if(!t.equals(this.listeners_.end())){o.target=this,o.timeStamp=new Date().getTime()-this.created_at_.getTime();try{for(var a=u(t.second),f=a.next();!f.done;f=a.next()){var c=f.value;c(o)}}catch(l){e={error:l}}finally{try{f&&!f.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},r.prototype.addEventListener=function(o,e){var n=this.listeners_.find(o);n.equals(this.listeners_.end())&&(n=this.listeners_.emplace(o,new i.HashSet).first),n.second.insert(e)},r.prototype.removeEventListener=function(o,e){var n=this.listeners_.find(o);n.equals(this.listeners_.end())||(n.second.erase(e),n.second.empty()&&this.listeners_.erase(n))},r}();return ae.EventTarget=s,ae}var Ee={},Dt;function ze(){if(Dt)return Ee;Dt=1,Object.defineProperty(Ee,"__esModule",{value:!0});var u=function(){function i(h,s){this.type=h,s&&Object.assign(this,s)}return i}();return Ee.Event=u,Ee}var ce={},Kt;function Tn(){if(Kt)return ce;Kt=1;var u=ce&&ce.__extends||function(){var s=function(r,o){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},s(r,o)};return function(r,o){s(r,o);function e(){this.constructor=r}r.prototype=o===null?Object.create(o):(e.prototype=o.prototype,new e)}}();Object.defineProperty(ce,"__esModule",{value:!0});var i=ze(),h=function(s){u(r,s);function r(o,e){return s.call(this,o,e)||this}return r}(i.Event);return ce.CloseEvent=h,ce}var le={},Ut;function $n(){if(Ut)return le;Ut=1;var u=le&&le.__extends||function(){var s=function(r,o){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},s(r,o)};return function(r,o){s(r,o);function e(){this.constructor=r}r.prototype=o===null?Object.create(o):(e.prototype=o.prototype,new e)}}();Object.defineProperty(le,"__esModule",{value:!0});var i=ze(),h=function(s){u(r,s);function r(o,e){return s.call(this,o,e)||this}return r}(i.Event);return le.MessageEvent=h,le}var ue={},Bt;function Hn(){if(Bt)return ue;Bt=1;var u=ue&&ue.__extends||function(){var s=function(r,o){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},s(r,o)};return function(r,o){s(r,o);function e(){this.constructor=r}r.prototype=o===null?Object.create(o):(e.prototype=o.prototype,new e)}}();Object.defineProperty(ue,"__esModule",{value:!0});var i=ze(),h=function(s){u(r,s);function r(o,e){return s.call(this,o,e)||this}return r}(i.Event);return ue.ErrorEvent=h,ue}var Gt;function Dn(){return Gt||(Gt=1,function(u){var i=B&&B.__extends||function(){var c=function(l,d){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,v){_.__proto__=v}||function(_,v){for(var y in v)v.hasOwnProperty(y)&&(_[y]=v[y])},c(l,d)};return function(l,d){c(l,d);function _(){this.constructor=l}l.prototype=d===null?Object.create(d):(_.prototype=d.prototype,new _)}}(),h=B&&B.__assign||function(){return h=Object.assign||function(c){for(var l,d=1,_=arguments.length;d<_;d++){l=arguments[d];for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(c[v]=l[v])}return c},h.apply(this,arguments)};Object.defineProperty(u,"__esModule",{value:!0});var s=mn(),r=An(),o=ze(),e=Tn(),n=$n(),t=Hn(),a=function(c){i(l,c);function l(d,_){var v=c.call(this)||this;return v.on_={},v.state_=l.CONNECTING,v.client_=new s.client,v.client_.on("connect",v._Handle_connect.bind(v)),v.client_.on("connectFailed",v._Handle_error.bind(v)),typeof _=="string"&&(_=[_]),v.client_.connect(d,_),v}return l.prototype.close=function(d,_){this.state_=l.CLOSING,d===void 0?this.connection_.sendCloseFrame():this.connection_.sendCloseFrame(d,_,!0)},l.prototype.send=function(d){if(typeof d.valueOf()=="string")this.connection_.sendUTF(d);else{var _=void 0;d instanceof Buffer?_=d:d instanceof Blob?_=new Buffer(d,"blob"):d.buffer?_=new Buffer(d.buffer):_=new Buffer(d),this.connection_.sendBytes(_)}},Object.defineProperty(l.prototype,"url",{get:function(){return this.client_.url.href},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"protocol",{get:function(){return this.client_.protocols?this.client_.protocols[0]:""},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"extensions",{get:function(){return this.connection_&&this.connection_.extensions?this.connection_.extensions[0].name:""},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"readyState",{get:function(){return this.state_},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bufferedAmount",{get:function(){return this.connection_.bytesWaitingToFlush},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"binaryType",{get:function(){return"arraybuffer"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onopen",{get:function(){return this.on_.open},set:function(d){this._Set_on("open",d)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onclose",{get:function(){return this.on_.close},set:function(d){this._Set_on("close",d)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onmessage",{get:function(){return this.on_.message},set:function(d){this._Set_on("message",d)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onerror",{get:function(){return this.on_.error},set:function(d){this._Set_on("error",d)},enumerable:!0,configurable:!0}),l.prototype._Set_on=function(d,_){this.on_[d]&&this.removeEventListener(d,this.on_[d]),this.addEventListener(d,_),this.on_[d]=_},l.prototype._Handle_connect=function(d){this.connection_=d,this.state_=l.OPEN,this.connection_.on("message",this._Handle_message.bind(this)),this.connection_.on("error",this._Handle_error.bind(this)),this.connection_.on("close",this._Handle_close.bind(this));var _=new o.Event("open",f);this.dispatchEvent(_)},l.prototype._Handle_close=function(d,_){var v=new e.CloseEvent("close",h({},f,{code:d,reason:_}));this.state_=l.CLOSED,this.dispatchEvent(v)},l.prototype._Handle_message=function(d){var _=new n.MessageEvent("message",h({},f,{data:d.binaryData?d.binaryData:d.utf8Data}));this.dispatchEvent(_)},l.prototype._Handle_error=function(d){var _=new t.ErrorEvent("error",h({},f,{error:d,message:d.message}));this.state_===l.CONNECTING&&(this.state_=l.CLOSED),this.dispatchEvent(_)},l}(r.EventTarget);u.WebSocket=a,function(c){c.CONNECTING=0,c.OPEN=1,c.CLOSING=2,c.CLOSED=3}(a=u.WebSocket||(u.WebSocket={})),u.WebSocket=a;var f={bubbles:!1,cancelable:!1}}(B)),B}var Wt;function Kn(){if(Wt)return Te;Wt=1,Object.defineProperty(Te,"__esModule",{value:!0});var u=sr();return u.is_node()&&(Pe.WebSocket=Dn().WebSocket),Te}Kn();const Xe=()=>{const u=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${u}px`)};Xe();window.addEventListener("resize",Xe);window.addEventListener("orientationchange",Xe);const Un=Ar.createRoot(document.getElementById("root"));Un.render(p.jsx(de.StrictMode,{children:p.jsx(pn,{})}));document.documentElement.classList.add("js-enabled");console.log("ðŸŒŸ Nostr Social Feed initialized");console.log("ðŸŽ¨ Zen design system loaded");console.log("ðŸ”— Nostr protocol ready");
